function jivoMobileLabel(){if(document.querySelector("meta[name=viewport]")){for(var t,e=document.querySelector("meta[name=viewport]").getAttribute("content").split(","),i=!1,n=0;n<e.length;n++){e[n]=e[n].replace(/^\s+/,"");var o=e[n].split("=");"maximum-scale"==o[0]&&(i=!0,o[1]>1&&(o[1]="1.2")),e[n]=o[0]+"="+o[1]}i||e.push("maximum-scale=1.2"),t=e.join(", "),document.querySelector("meta[name=viewport]").setAttribute("content",t)}else{var s=document.createElement("meta");s.id="viewport",s.name="viewport",s.content="width=device-width, height=device-height, initial-scale=0.33, maximum-scale=1.2",document.getElementsByTagName("head")[0].appendChild(s)}setInterval(function(){if(document.getElementById("jivo-label")){var t=0,e=290,i=500,n=window.innerWidth||window.pageXOffset||document.documentElement.clientWidth||document.getElementsByTagName("html")[0],o=(n/e).toFixed(3);(window.matchMedia("(orientation: landscape)").matches||90===Math.abs(window.orientation))&&(o=(n/i).toFixed(3)),o!=t&&(document.getElementById("jivo-label").style.zoom=o,t=o)}},100)}(window.jivo_init=function(){function getElementsByClassName(t){var e;try{e=document.getElementsByClassName(t)}catch(i){e=[];for(var n=new RegExp("\\b"+t+"\\b"),o=document.getElementsByTagName("*"),s=0;s<o.length;s++){var a=o[s].className;n.test(a)&&e.push(o[s])}}return e}function log(){if("logs"in config){var t=Array.prototype.slice.call(arguments);if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var e=0;e<arguments.length;)console.log("Item "+(e+1)+": "+arguments[e]),e++;else console.log(1==t.length&&"string"==typeof t[0]?t.toString():t);else"undefined"!=typeof console&&"object"==typeof console.log&&Function.prototype.call.call(console.log,console,t)}}function addListener(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&(t.attachEvent("on"+e,function(t){return function(){i.call(t,window.event)}}(t)),t=null)}function removeEvent(t,e,i){if(window.removeEventListener)t.removeEventListener(e,i,!1);else{if(!window.detachEvent)return!1;var n=function(){i.call(t)};t.detachEvent("on"+e,n)}}function loadScript(t,e,i){var n=document.createElement("script");n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"==n.readyState||"complete"==n.readyState?(n.onreadystatechange=null,e()):i({target:n,readyState:readyState})}:(n.onload=function(t){e()},n.onerror=function(t){i(t)}),n.src=t,"undefined"!=typeof log&&log("adding script "+t),document.getElementsByTagName("head")[0].appendChild(n)}function setIframeLoadCallback(t,e){t.readyState?(log("Using readyState callback"),t.onreadystatechange=function(){("loaded"==t.readyState||"complete"==t.readyState)&&(t.onreadystatechange=null,e())}):(log("Using onload callback"),t.onload=function(){"about:blank"!=t.contentWindow.location.href&&(e(),t.onload=null)})}function installF9ReloadCss(){$("body").keydown(function(t){if("120"==t.keyCode){log("reloading css");var e,i,n;for(i=document.getElementsByTagName("link"),e=0;e<i.length;e++)if(n=i[e],n.rel.toLowerCase().indexOf("stylesheet")>=0&&n.href){var o=n.href.replace(/(&|%5C?)forceReload=\d+/,"");n.href=o+(o.indexOf("?")>=0?"&":"?")+"forceReload="+(new Date).valueOf()}}})}function translate(t){return"custom_langpack"in config&&t in config.custom_langpack?config.custom_langpack[t].replace(/\n/g,"<br />").replace(/'/g,"&#039;"):translate_basic(t)}function translate_basic(t){return t in base_langpack?base_langpack[t].replace(/\n/g,"<br />"):t}function reductionTranslate(t){return(config.locale="ru_RU")?t.substr(0,4):t}function cookie(t,e,i){if("__utmz"!=t&&(t=["jv",t,config.widget_id].join("_")),arguments.length>1&&"[object Object]"!==String(e)){if("undefined"==typeof i&&(i={}),null===e||void 0===e?(log("Clearing COOKIE "+t),i.expires=-1):log("Set COOKIE "+t+" with value "+e),"number"==typeof i.expires){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}return e=String(e),document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),i.expires?"; expires="+i.expires.toUTCString():"",config.cookie_domain&&!jivo.isSeparateWindow()?"; domain="+config.cookie_domain:"","; path=/"].join("")}i=e||{};var s,a=i.raw?function(t){return t}:decodeURIComponent;return(s=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie))?a(s[1]):null}function getJSONP(t,e){var i=new jivoXHR;i.open("GET",t),i.onload=e,i.send()}function getJSONPWithData(t,e,i){t+="?cb=?",e.t=(new Date).getTime();for(var n in e)t+="&"+n+"="+encodeURIComponent(e[n]);return getJSONP(t,i)}function reportException(t){if(!(++error_sent_cnt>3))try{getJSONPWithData("//err.jivosite.com/widget",{widget_id:config.widget_id,message:t.message,url:window.top.location.href,lineNumber:t.lineNumber,fileName:t.fileName},log)}catch(t){log(t.message)}}function telemetry(t,e){"object"!=typeof e&&(e={}),e.event=t,e.widget_id=config.widget_id,e.chat_mode=config.chat_mode,cookie("client_id")&&(e.client_id=cookie("client_id").split(".")[0]);try{getJSONPWithData("//telemetry.jivosite.com/w",e,log)}catch(i){log(i.message)}}function callWidgetPing(t,e){var i={name:"cw_ping"};cookie("client_id")&&(i.jv_client_id=cookie("client_id")),cookie("sess_id")&&(i.jv_sess_id=cookie("sess_id")),e&&(i=underscore.extend(i,e)),getJSONPWithData(chatServerUrl(config.widget_id,config.site_id),i,function(e){"ok"===e.result&&t(e)})}function setUTMParams(t){var e,i,n=t.substr(t.indexOf("?")+1),o=n.split("&"),s="";for(i=o.length;i--;)e=o[i].split("="),e[0].indexOf("utm_")>=0&&(e=o[i],s+=(s.length>0?"|":"")+e.substr(e.indexOf("utm_")+4));s&&cookie("utm",s)}function createXPathFromElement(t){var e=document.getElementsByTagName("*");for(segs=[];t&&1==t.nodeType;t=t.parentNode)if(t.hasAttribute("id")){for(var n=0,o=0;o<e.length&&(e[o].hasAttribute("id")&&e[o].id==t.id&&n++,!(n>1));o++);if(1==n)return segs.unshift('id("'+t.getAttribute("id")+'")'),segs.join("/");segs.unshift(t.localName.toLowerCase()+'[@id="'+t.getAttribute("id")+'"]')}else if(t.hasAttribute("class"))segs.unshift(t.localName.toLowerCase()+'[@class="'+t.getAttribute("class")+'"]');else{for(i=1,sib=t.previousSibling;sib;sib=sib.previousSibling)sib.localName==t.localName&&i++;segs.unshift(t.localName.toLowerCase()+"["+i+"]")}return segs.length?"/"+segs.join("/"):null}function highlightUrls(t){var e=/(\s|"|'|^)((?:(?:http|https|ftp|ftps|mailto):\/\/)?)((?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*\.(?:рф|com|aero|biz|com|coop|edu|eu|gov|info|int|mil|museum|name|net|org|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|travel|xxx|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)(?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*)/gim;return stripBrackets(t).replace(e,function(t,e,i,n){i||(i="http://");var o=document.domain;if(o=o.replace("www.",""),-1==n.indexOf(o,0))var s="_blank";else var s="col_old_page";return e+"<a href='"+i+n+"' target='"+s+"'>"+n+"</a>"})}function nl2br(t){return t.replace(/\n/g,"<br />")}function stripBrackets(t){return underscore.isUndefined(t)?"":t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function splitClasses(t){return underscore.isArray(t)?t:t.replace(/^\s+|\s+$/g,"").split(/\s+/)}function forseRedraw(t){t.offsetHeight}function getClasses(t){return splitClasses(t.className)}function setClasses(t,e){var i=e.join(" ");t.className!==i&&(t.className=i,forseRedraw(t))}function removeProperty(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)}function removeElement(t){t.parentNode.removeChild(t)}function prefixedEvent(t,e,i){for(var n=["webkit","moz","MS","o",""],o=0;o<n.length;o++)n[o]||(e=e.toLowerCase()),t.addEventListener(n[o]+e,i,!1)}function css3AnimationIsSupported(){var t=utils.browser,e=t.name;return!!("Firefox"===e&&t.mV>23||"Chrome"===e&&t.mV>28||"Safari"===e&&t.mV>5)}function switchClasses(t,e,i){removeClass(t,e),addClass(t,i)}function getOffsetRect(t){var e=t.getBoundingClientRect(),i=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||i.scrollTop,s=window.pageXOffset||n.scrollLeft||i.scrollLeft,a=n.clientTop||i.clientTop||0,r=n.clientLeft||i.clientLeft||0,c=e.top+o-a,l=e.left+s-r;return{top:Math.round(c),left:Math.round(l)}}function getElementPosition(t){function e(t){return t.compatMode&&"BackCompat"!=t.compatMode?t.documentElement:t.body}var i,n=t.ownerDocument,o=n.all&&!window.opera,s=o?e(n):n.defaultView||n.parentWindow,a={left:0,top:0};if(t.getBoundingClientRect)a=underscore.extend(a,t.getBoundingClientRect());else for(i=t;i;)a.left+=i.offsetLeft,a.top+=i.offsetTop,i=i.offsetParent;return a.width=t.offsetWidth,a.height=t.offsetHeight,a.windowWidth=o?s.clientWidth:s.innerWidth,a.windowHeight=o?s.clientHeight:s.innerHeight,a}function setElementPosition(t,e){return t.style.cssText+="; top: "+e.top+"px; left : "+e.left+"px; width : "+e.width+"px; height: "+e.height+"px",this}function setSubstrTitle(t){return t.substr(0,255)}function getConfigContactsAsk(){var t=!0;underscore.each(["name","phone","email"],function(e){config.contacts_settings[e].show&&(t=!1)},this),t&&(config.contacts_ask=2)}function getIconLocale(){if(void 0===config.iconLocale){var t=underscore.find(["ru_RU","be","kk","uk"],function(t){return t===config.locale});config.iconLocale=t?t:"en"}return config.iconLocale}function getURLParam(t,e){for(var i=(e||window.location||"").search.substring(1),n=i.split("&"),o=0;o<n.length;o++){var s=n[o].split("=");if(s[0]==t)return decodeURIComponent(s[1])}}function getByIdFromParent(t){var e=window.parent.document,i=e.getElementById(t);return i&&$(i)}function proxy(t,e,i){return t[e].apply(t,i)}function staticUrl(t,e){return e||(t+="?rnd=100654"),config.static_host?"//"+config.static_host+t:config.base_url+t}function chatServerUrl(){var t=window.location.protocol+"//";return"comet"in config?(t+=config.comet.host,"https:"==window.location.protocol?"secure_port"in config.comet&&(t+=":"+config.comet.secure_port):"plain_port"in config.comet&&(t+=":"+config.comet.plain_port)):t+="node.jivosite.com",t+"/jsonp/"+underscore.toArray(arguments).join("/")}function hexToR(t){return parseInt(cutHex(t).substring(0,2),16)}function hexToG(t){return parseInt(cutHex(t).substring(2,4),16)}function hexToB(t){return parseInt(cutHex(t).substring(4,6),16)}function cutHex(t){return"#"==t.charAt(0)?t.substring(1,7):t}function rgbToHex(t,e,i){return toHex(t)+toHex(e)+toHex(i)}function toHex(t){return t=parseInt(t,10),isNaN(t)?"00":(t=Math.max(0,Math.min(t,255)),"0123456789ABCDEF".charAt((t-t%16)/16)+"0123456789ABCDEF".charAt(t%16))}function adjustLightness(t,e,i){var n=hexToR(t),o=hexToG(t),s=hexToB(t),a=ColorConverter.toHSV(new RGB(n,o,s));a.v=a.v>0?a.v*e:100*(e-1),a.s=a.s*i;var r=ColorConverter.toRGB(a),c=rgbToHex(r.r,r.g,r.b);return"#"+c}function getLightness(t){var e=hexToR(t),i=hexToG(t),n=hexToB(t),o=ColorConverter.toHSV(new RGB(e,i,n));return log("hsv.v="+o.v),o.v}function isLightColor(t){return getLightness(t)>65}function HSV(t,e,i){0>=t&&(t=0),0>=e&&(e=0),0>=i&&(i=0),t>360&&(t=360),e>100&&(e=100),i>100&&(i=100),this.h=t,this.s=e,this.v=i}function RGB(t,e,i){0>=t&&(t=0),0>=e&&(e=0),0>=i&&(i=0),t>255&&(t=255),e>255&&(e=255),i>255&&(i=255),this.r=t,this.g=e,this.b=i}function CMYK(t,e,i,n){0>=t&&(t=0),0>=e&&(e=0),0>=i&&(i=0),0>=n&&(n=0),t>100&&(t=100),e>100&&(e=100),i>100&&(i=100),n>100&&(n=100),this.c=t,this.m=e,this.y=i,this.k=n}var config=window.jivo_config;(function(){var t=this,e=t._,i={},n=Array.prototype,o=Object.prototype,s=(Function.prototype,n.push),a=n.slice,r=n.concat,c=o.toString,l=o.hasOwnProperty,h=n.forEach,u=n.map,d=n.reduce,f=n.reduceRight,m=n.filter,g=n.every,v=n.some,_=n.indexOf,p=n.lastIndexOf,w=Array.isArray,b=Object.keys,y=!1,j=function(t){return t instanceof j?t:this instanceof j?void(this._wrapped=t):new j(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):t._=j,j.VERSION="1.4.4";var E=j.each=j.forEach=function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var o=0,s=t.length;s>o;o++)if(e.call(n,t[o],o,t)===i)return}else for(var a in t)if(j.has(t,a)&&e.call(n,t[a],a,t)===i)return};j.map=j.collect=function(t,e,i){var n=[];return null==t?n:u&&t.map===u?t.map(e,i):(E(t,function(t,o,s){n[n.length]=e.call(i,t,o,s)}),n)};var C="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(t,e,i,n){var o=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return n&&(e=j.bind(e,n)),o?t.reduce(e,i):t.reduce(e);if(E(t,function(t,s,a){o?i=e.call(n,i,t,s,a):(i=t,o=!0)}),!o)throw new TypeError(C);return i},j.reduceRight=j.foldr=function(t,e,i,n){var o=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=j.bind(e,n)),o?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var a=j.keys(t);s=a.length}if(E(t,function(r,c,l){c=a?a[--s]:--s,o?i=e.call(n,i,t[c],c,l):(i=t[c],o=!0)}),!o)throw new TypeError(C);return i},j.find=j.detect=function(t,e,i){var n;return k(t,function(t,o,s){return e.call(i,t,o,s)?(n=t,!0):void 0}),n},j.filter=j.select=function(t,e,i){var n=[];return null==t?n:m&&t.filter===m?t.filter(e,i):(E(t,function(t,o,s){e.call(i,t,o,s)&&(n[n.length]=t)}),n)},j.reject=function(t,e,i){return j.filter(t,function(t,n,o){return!e.call(i,t,n,o)},i)},j.every=j.all=function(t,e,n){e||(e=j.identity);var o=!0;return null==t?o:g&&t.every===g?t.every(e,n):(E(t,function(t,s,a){return(o=o&&e.call(n,t,s,a))?void 0:i}),!!o)};var k=j.some=j.any=function(t,e,n){e||(e=j.identity);var o=!1;return null==t?o:v&&t.some===v?t.some(e,n):(E(t,function(t,s,a){return o||(o=e.call(n,t,s,a))?i:void 0}),!!o)};j.contains=j.include=function(t,e){return null==t?!1:_&&t.indexOf===_?-1!=t.indexOf(e):k(t,function(t){return t===e})},j.invoke=function(t,e){var i=a.call(arguments,2),n=j.isFunction(e);return j.map(t,function(t){return(n?e:t[e]).apply(t,i)})},j.pluck=function(t,e){return j.map(t,function(t){return t[e]})},j.where=function(t,e,i){return j.isEmpty(e)?i?null:[]:j[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},j.findWhere=function(t,e){return j.where(t,e,!0)},j.max=function(t,e,i){if(!e&&j.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&j.isEmpty(t))return-(1/0);var n={computed:-(1/0),value:-(1/0)};return E(t,function(t,o,s){var a=e?e.call(i,t,o,s):t;a>=n.computed&&(n={value:t,computed:a})}),n.value},j.min=function(t,e,i){if(!e&&j.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&j.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return E(t,function(t,o,s){var a=e?e.call(i,t,o,s):t;a<n.computed&&(n={value:t,computed:a})}),n.value},j.shuffle=function(t){var e,i=0,n=[];return E(t,function(t){e=j.random(i++),n[i-1]=n[e],n[e]=t}),n};var T=function(t){return j.isFunction(t)?t:function(e){return e[t]}};j.sortBy=function(t,e,i){var n=T(e);return j.pluck(j.map(t,function(t,e,o){return{value:t,index:e,criteria:n.call(i,t,e,o)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var I=function(t,e,i,n){var o={},s=T(e||j.identity);return E(t,function(e,a){var r=s.call(i,e,a,t);n(o,r,e)}),o};j.groupBy=function(t,e,i){return I(t,e,i,function(t,e,i){(j.has(t,e)?t[e]:t[e]=[]).push(i)})},j.countBy=function(t,e,i){return I(t,e,i,function(t,e){j.has(t,e)||(t[e]=0),t[e]++})},j.sortedIndex=function(t,e,i,n){i=null==i?j.identity:T(i);for(var o=i.call(n,e),s=0,a=t.length;a>s;){var r=s+a>>>1;i.call(n,t[r])<o?s=r+1:a=r}return s},j.toArray=function(t){return t?j.isArray(t)?a.call(t):t.length===+t.length?j.map(t,j.identity):j.values(t):[]},j.size=function(t){return null==t?0:t.length===+t.length?t.length:j.keys(t).length},j.first=j.head=j.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:a.call(t,0,e)},j.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},j.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},j.rest=j.tail=j.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},j.compact=function(t){return j.filter(t,j.identity)};var S=function(t,e,i){return E(t,function(t){j.isArray(t)?e?s.apply(i,t):S(t,e,i):i.push(t)}),i};j.flatten=function(t,e){return S(t,e,[])},j.without=function(t){return j.difference(t,a.call(arguments,1))},j.uniq=j.unique=function(t,e,i,n){j.isFunction(e)&&(n=i,i=e,e=!1);var o=i?j.map(t,i,n):t,s=[],a=[];return E(o,function(i,n){(e?n&&a[a.length-1]===i:j.contains(a,i))||(a.push(i),s.push(t[n]))}),s},j.union=function(){return j.uniq(r.apply(n,arguments))},j.intersection=function(t){var e=a.call(arguments,1);return j.filter(j.uniq(t),function(t){return j.every(e,function(e){return j.indexOf(e,t)>=0})})},j.difference=function(t){var e=r.apply(n,a.call(arguments,1));return j.filter(t,function(t){return!j.contains(e,t)})},j.zip=function(){for(var t=a.call(arguments),e=j.max(j.pluck(t,"length")),i=new Array(e),n=0;e>n;n++)i[n]=j.pluck(t,""+n);return i},j.object=function(t,e){if(null==t)return{};for(var i={},n=0,o=t.length;o>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},j.indexOf=function(t,e,i){if(null==t)return-1;var n=0,o=t.length;if(i){if("number"!=typeof i)return n=j.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,o+i):i}if(_&&t.indexOf===_)return t.indexOf(e,i);for(;o>n;n++)if(t[n]===e)return n;return-1},j.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(p&&t.lastIndexOf===p)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var o=n?i:t.length;o--;)if(t[o]===e)return o;return-1},j.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),o=0,s=new Array(n);n>o;)s[o++]=t,t+=i;return s},j.bind=function(t,e){if(t.bind===y&&y)return y.apply(t,a.call(arguments,1));var i=a.call(arguments,2);return function(){return t.apply(e,i.concat(a.call(arguments)))}},j.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},j.bindAll=function(t){var e=a.call(arguments,1);return 0===e.length&&(e=j.functions(t)),E(e,function(e){t[e]=j.bind(t[e],t)}),t},j.memoize=function(t,e){var i={};return e||(e=j.identity),function(){var n=e.apply(this,arguments);return j.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},j.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},j.defer=function(t){return j.delay.apply(j,[t,1].concat(a.call(arguments,1)))},j.throttle=function(t,e){var i,n,o,s,a=0,r=function(){a=new Date,o=null,s=t.apply(i,n)};return function(){var c=new Date,l=e-(c-a);return i=this,n=arguments,0>=l?(clearTimeout(o),o=null,a=c,s=t.apply(i,n)):o||(o=setTimeout(r,l)),s}},j.debounce=function(t,e,i){var n,o;return function(){var s=this,a=arguments,r=function(){n=null,i||(o=t.apply(s,a))},c=i&&!n;return clearTimeout(n),n=setTimeout(r,e),c&&(o=t.apply(s,a)),o}},j.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},j.wrap=function(t,e){return function(){var i=[t];return s.apply(i,arguments),e.apply(this,i)}},j.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},j.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},j.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)j.has(t,i)&&(e[e.length]=i);return e},j.values=function(t){var e=[];for(var i in t)j.has(t,i)&&e.push(t[i]);return e},j.pairs=function(t){var e=[];for(var i in t)j.has(t,i)&&e.push([i,t[i]]);return e},j.invert=function(t){var e={};for(var i in t)j.has(t,i)&&(e[t[i]]=i);return e},j.functions=j.methods=function(t){var e=[];for(var i in t)j.isFunction(t[i])&&e.push(i);return e.sort()},j.extend=function(t){return E(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},j.pick=function(t){var e={},i=r.apply(n,a.call(arguments,1));return E(i,function(i){i in t&&(e[i]=t[i])}),e},j.omit=function(t){var e={},i=r.apply(n,a.call(arguments,1));for(var o in t)j.contains(i,o)||(e[o]=t[o]);return e},j.defaults=function(t){return E(a.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},j.clone=function(t){return j.isObject(t)?j.isArray(t)?t.slice():j.extend({},t):t},j.tap=function(t,e){return e(t),t};var x=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof j&&(t=t._wrapped),e instanceof j&&(e=e._wrapped);var o=c.call(t);if(o!=c.call(e))return!1;switch(o){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;i.push(t),n.push(e);var a=0,r=!0;if("[object Array]"==o){if(a=t.length,r=a==e.length)for(;a--&&(r=x(t[a],e[a],i,n)););}else{var l=t.constructor,h=e.constructor;if(l!==h&&!(j.isFunction(l)&&l instanceof l&&j.isFunction(h)&&h instanceof h))return!1;for(var u in t)if(j.has(t,u)&&(a++,!(r=j.has(e,u)&&x(t[u],e[u],i,n))))break;if(r){for(u in e)if(j.has(e,u)&&!a--)break;r=!a}}return i.pop(),n.pop(),r};j.isEqual=function(t,e){return x(t,e,[],[])},j.isEmpty=function(t){if(null==t)return!0;if(j.isArray(t)||j.isString(t))return 0===t.length;for(var e in t)if(j.has(t,e))return!1;return!0},j.isElement=function(t){return!(!t||1!==t.nodeType)},j.isArray=w||function(t){return"[object Array]"==c.call(t)},j.isObject=function(t){return t===Object(t)},E(["Arguments","Function","String","Number","Date","RegExp"],function(t){j["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),j.isArguments(arguments)||(j.isArguments=function(t){return!(!t||!j.has(t,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(t){return"function"==typeof t}),j.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},j.isNaN=function(t){return j.isNumber(t)&&t!=+t},j.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},j.isNull=function(t){return null===t},j.isUndefined=function(t){return void 0===t},j.has=function(t,e){return l.call(t,e)},j.noConflict=function(){return t._=e,this},j.identity=function(t){return t},j.times=function(t,e,i){for(var n=Array(t),o=0;t>o;o++)n[o]=e.call(i,o);return n},j.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};N.unescape=j.invert(N.escape);var O={escape:new RegExp("["+j.keys(N.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(N.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(t){j[t]=function(e){return null==e?"":(""+e).replace(O[t],function(e){return N[t][e]})}}),j.result=function(t,e){if(null==t)return null;var i=t[e];return j.isFunction(i)?i.call(t):i},j.mixin=function(t){E(j.functions(t),function(e){var i=j[e]=t[e];j.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),P.call(this,i.apply(j,t))}})};var A=0;j.uniqueId=function(t){var e=++A+"";return t?t+e:e},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(t,e,i){var n;i=j.defaults({},i,j.templateSettings);var o=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(o,function(e,i,n,o,r){return a+=t.slice(s,r).replace(D,function(t){return"\\"+L[t]}),i&&(a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(a+="';\n"+o+"\n__p+='"),s=r+e.length,e}),a+="';\n",i.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(i.variable||"obj","_",a)}catch(r){throw r.source=a,r}if(e)return n(e,j);var c=function(t){return n.call(this,t,j)};return c.source="function("+(i.variable||"obj")+"){\n"+a+"}",c},j.chain=function(t){return j(t).chain()};var P=function(t){return this._chain?j(t).chain():t};j.mixin(j),E(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];j.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],P.call(this,i)}}),E(["concat","join","slice"],function(t){var e=n[t];j.prototype[t]=function(){return P.call(this,e.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);var machina=function(t,e){var i=[].slice,n="transition",o="handler",s="handling",a="handled",r="nohandler",c="transition",l="invalidstate",h="deferred",u="newfsm",d={makeFsmNamespace:function(){var t=0;return function(){return"fsm."+t++}}(),getDefaultOptions:function(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},eventQueue:[],namespace:d.makeFsmNamespace(),targetReplayState:"",state:e,priorState:e,_priorAction:"",_currentAction:""}}};if(!t.deepExtend){var f={"*":function(t,e,i){t[e]=i},object:function(t,e,i){t[e]=v({},t[e]||{},i)},array:function(e,i,n){e[i]=[],t.each(n,function(t,n){f[g(t)](e[i],n,t)},this)}},m=function(e){return t.isArray(e)?"array":t.isDate(e)?"date":t.isRegExp(e)?"regex":typeof e},g=function(t){var e=m(t);return f[e]?e:"*"},v=function(e){return t.each(i.call(arguments,1),function(i){t.each(i,function(t,i){f[g(t)](e,i,t)})}),e};t.mixin({deepExtend:v})}var _=function(e){t.extend(this,e),t.defaults(this,d.getDefaultOptions()),this.initialize.apply(this,arguments),b.emit(u,this),this.initialState&&this.transition(this.initialState)};t.extend(_.prototype,{initialize:function(){},emit:function(e){var n=arguments;this.eventListeners["*"]&&t.each(this.eventListeners["*"],function(t){try{t.apply(this,i.call(n,0))}catch(e){reportException(e),log(e.message)}},this),this.eventListeners[e]&&t.each(this.eventListeners[e],function(t){try{t.apply(this,i.call(n,1))}catch(e){reportException(e),log(e.message)}},this)},handle:function(n){if(!this.inExitHandler){var c,l,h,u,d=this.states,f=this.state,m=i.call(arguments,0);this.currentActionArgs=m,d[f][n]||d[f]["*"]||this["*"]?(c=d[f][n]?n:"*",h="*"===c,d[f][c]?(l=d[f][c],u=f+"."+c):(l=this["*"],u="*"),this._currentAction||(this._currentAction=u),this.emit.call(this,s,{inputType:n,args:m.slice(1)}),t.isFunction(l)&&(l=l.apply(this,h?m:m.slice(1))),t.isString(l)&&this.transition(l),this.emit.call(this,a,{inputType:n,args:m.slice(1)}),this._priorAction=this._currentAction,this._currentAction="",this.processQueue(o)):this.emit.call(this,r,{inputType:n,args:m.slice(1)}),this.currentActionArgs=e}},transition:function(t){if(!this.inExitHandler&&t!==this.state){var e;if(this.states[t]){if(this.targetReplayState=t,this.priorState=this.state,this.state=t,e=this.priorState,this.states[e]&&this.states[e]._onExit&&(this.inExitHandler=!0,this.states[e]._onExit.call(this),this.inExitHandler=!1),this.emit.call(this,c,{fromState:e,action:this._currentAction,toState:t}),this.states[t]._onEnter)try{this.states[t]._onEnter.call(this)}catch(i){reportException(i),log(i.message)}return void(this.targetReplayState===t&&this.processQueue(n))}this.emit.call(this,l,{state:this.state,attemptedState:t})}},processQueue:function(e){var i=e===n?function(t){return t.type===n&&(!t.untilState||t.untilState===this.state)}:function(t){return t.type===o},s=t.filter(this.eventQueue,i,this);this.eventQueue=t.difference(this.eventQueue,s),t.each(s,function(t){this.handle.apply(this,t.args)},this)},clearQueue:function(e,i){if(e){var s;e===n?s=function(t){return t.type===n&&(i?t.untilState===i:!0)}:e===o&&(s=function(t){return t.type===o}),this.eventQueue=t.filter(this.eventQueue,s)}else this.eventQueue=[]},deferUntilTransition:function(t){if(this.currentActionArgs){var e={type:n,untilState:t,args:this.currentActionArgs};this.eventQueue.push(e),this.emit.call(this,h,{state:this.state,queuedArgs:e})}},deferUntilNextHandler:function(){if(this.currentActionArgs){var t={type:n,args:this.currentActionArgs};this.eventQueue.push(t),this.emit.call(this,h,{state:this.state,queuedArgs:t})}},on:function(t,e){var i=this;return i.eventListeners[t]||(i.eventListeners[t]=[]),i.eventListeners[t].push(e),{eventName:t,callback:e,off:function(){i.off(t,e)}}},off:function(e,i){e?this.eventListeners[e]&&(this.eventListeners[e]=i?t.without(this.eventListeners[e],i):[]):this.eventListeners={}}}),_.prototype.trigger=_.prototype.emit;var p=function(){},w=function(e,i,n){var o;return o=i&&i.hasOwnProperty("constructor")?i.constructor:function(){e.apply(this,arguments)},t.deepExtend(o,e),p.prototype=e.prototype,o.prototype=new p,i&&t.deepExtend(o.prototype,i),n&&t.deepExtend(o,n),o.prototype.constructor=o,o.__super__=e.prototype,o};_.extend=function(t,e){var i=w(this,t,e);return i.extend=this.extend,i};var b={Fsm:_,utils:d,on:function(t,e){return this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(e),e},off:function(e,i){this.eventListeners[e]&&(this.eventListeners[e]=t.without(this.eventListeners[e],i))},trigger:function(e){var n=arguments,o=this.eventListeners[e]||[];o&&o.length&&t.each(o,function(t){t.apply(null,i.call(n,1))})},eventListeners:{newFsm:[]}};return b.emit=b.trigger,b}(_);(function(){var t,e,i,n;e=window.device,t={},window.device=t,n=window.navigator.userAgent.toLowerCase(),t.safari=function(){return i("safari")&&!t.chrome()},t.chrome=function(){return i("chrome")},t.ios=function(){return t.iphone()||t.ipod()||t.ipad()},t.iphone=function(){return!t.windows()&&i("iphone")},t.ipod=function(){return i("ipod")},t.ipad=function(){return i("ipad")},t.chromeIOS=function(){return i("crios")},t.android=function(){return!t.windows()&&i("android")},t.androidPhone=function(){return t.android()&&i("mobile")},t.androidTablet=function(){return t.android()&&!i("mobile")},t.blackberry=function(){return i("blackberry")||i("bb10")||i("rim")},t.blackberryPhone=function(){return t.blackberry()&&!i("tablet")},t.blackberryTablet=function(){return t.blackberry()&&i("tablet")},t.windows=function(){return i("windows")},t.windowsPhone=function(){return t.windows()&&i("phone")},t.windowsTablet=function(){return t.windows()&&i("touch")&&!t.windowsPhone()&&!i("trident")},t.fxos=function(){return(i("(mobile;")||i("(tablet;"))&&i("; rv:")},t.fxosPhone=function(){return t.fxos()&&i("mobile")},t.fxosTablet=function(){return t.fxos()&&i("tablet")},t.meego=function(){return i("meego")},t.cordova=function(){return window.cordova&&"file:"===location.protocol},t.nodeWebkit=function(){return"object"==typeof window.process},t.mobile=function(){return t.androidPhone()||t.iphone()||t.ipod()||t.windowsPhone()||t.blackberryPhone()||t.fxosPhone()||t.meego()},t.tablet=function(){return t.ipad()||t.androidTablet()||t.blackberryTablet()||t.windowsTablet()||t.fxosTablet()},t.desktop=function(){return!t.tablet()&&!t.mobile()},t.television=function(){var t,e=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"];

for(t=0;t<e.length;){if(i(e[t]))return!0;t++}return!1},t.portrait=function(){return window.innerHeight/window.innerWidth>1},t.landscape=function(){return window.innerHeight/window.innerWidth<1},t.noConflict=function(){return window.device=e,this},i=function(t){return-1!==n.indexOf(t)}}).call(this);var underscore=_.noConflict(),devicejs=device.noConflict();underscore.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var ie8=-1==navigator.appVersion.indexOf("MSIE 8.")?!1:!0,ie9=-1==navigator.appVersion.indexOf("MSIE 9.")?!1:!0,ie=-1==navigator.appVersion.indexOf("MSIE")?!1:!0,dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(o,s,a){var r=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,o=void 0),"string"==typeof o&&isNaN(new Date(o))&&(o=o.replace(/-/g,"/").replace("T"," ").split(".").shift()+"Z"),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");s=String(r.masks[s]||s||r.masks["default"]),"UTC:"==s.slice(0,4)&&(s=s.slice(4),a=!0);var c=a?"getUTC":"get",l=o[c+"Date"](),h=o[c+"Day"](),u=o[c+"Month"](),d=o[c+"FullYear"](),f=o[c+"Hours"](),m=o[c+"Minutes"](),g=o[c+"Seconds"](),v=o[c+"Milliseconds"](),_=a?0:o.getTimezoneOffset(),p={d:l,dd:n(l),ddd:r.i18n.dayNames[h],dddd:r.i18n.dayNames[h+7],m:u+1,mm:n(u+1),mmm:r.i18n.monthNames[u],mmmm:r.i18n.monthNames[u+12],yy:String(d).slice(2),yyyy:d,h:f%12||12,hh:n(f%12||12),H:f,HH:n(f),M:m,MM:n(m),s:g,ss:n(g),l:n(v,3),L:n(v>99?Math.round(v/10):v),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:a?"UTC":(String(o).match(e)||[""]).pop().replace(i,""),o:(_>0?"-":"+")+n(100*Math.floor(Math.abs(_)/60)+Math.abs(_)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return s.replace(t,function(t){return t in p?p[t]:t.slice(1,t.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};var base_langpack={b_onlineCallDefaultText:"Позвонить нам бесплатно!",cw_callAfter:"Звонок через",cw_callButtonText:"Перезвонить",cw_callFree:"Звонок бесплатный. Сервис предоставлен",cw_chat:"Чат",cw_chatWithOperator:"чат с оператором",cw_close:"Закрыть",cw_code_restrict:"Недопустимое направление",cw_connecting:"Соединяем",cw_enterPhonePlaceholder:"Введите ваш телефон",cw_errInfoText:"Попробуйте позвонить еще раз, или напишите нам в чат.",cw_formCenterText:"Не нашли, что искали?",cw_form_second:"секунду",cw_form_secondd:"секунд",cw_form_seconds:"секунды",cw_pickUpPhone:"Возьмите трубку",cw_rate_limit:"Вызов на указанный номер невозможен",cw_repeatCall:"перезвонить",cw_repeatCallAgain:"Перезвонить еще раз",cw_reportPlaceholder:"Сообщите о проблеме, мы разберемся!",cw_reportProblem:"сообщить о проблеме",cw_seconds:"секунд",cw_textSend:"отправить",cw_thxForCall:"Спасибо Вам за звонок!",cw_typeInChat:"написать в чат",cw_unableToConnect:"Не смогли соединиться?",cw_weCalling:"Мы вам звоним",cw_weRecallAfter:"Перезвоним через",c_callConnected:"Вызов установлен",c_callDisconnected:"Вызов завершен",c_callProcessing:"Вызываем оператора...",defCallformTitle:"Оставьте свой номер, и мы перезвоним вам",defOfflineFormText:"Оставьте свое сообщение в этой форме, и мы получим его на e-mail и обязательно ответим!",defOfflineWidgetLabel:"Отправьте нам сообщение",defOfflineWidgetLabelMobile:"Сообщение",defOnlineWidgetLabel:"Напишите нам, мы онлайн!",defOnlineWidgetLabelMobile:"Консультант",defRuleInvitationText:"Здравствуйте! Я могу вам чем-то помочь?",defRuleRetaining:"Пожалуйста, подождите. Сейчас операторы заняты, но скоро кто-нибудь освободится и ответит вам!",lblAgentDisconnected:"Оператор отключился",lblCallMe:"Позвонить",lblCaptcha:"Введите код с картинки",lblCaptchaError:"Неверный код, введите еще раз",lblChatEnded:"Диалог завершен",lblChatIsOnline:"Консультант онлайн",lblConnectedToAgent:"Напишите Ваше сообщение!",lblConnectionLost:"Соединение потеряно. Восстанавливаем...",lblDeclineFile:"Отклонить",lblDefaultCobrowseComment:"Обратите внимание",lblEnterMessageHere:"Введите сообщение и нажмите Enter",lblEnterMessageOrPhoneHere:"Введите сообщение или номер телефона (перезвоним мгновенно)",lblEvaluateCancel:"Отменить",lblEvaluatePlease:"Оцените качество обслуживания",lblEvaluateThanks:"Спасибо за оценку!",lblHangUp:"Завершить соединение",lblHangUpShort:"Завершить",lblIntroduceButton:"Представиться",lblIntroduceName:"Ваше имя",lblIntroduceRequest:"Представьтесь, пожалуйста",lblIntroduceRequestBefore:"Представьтесь и начните чат!",lblLeaveMessage:"Оставить сообщение",lblLookingForFreeAgent:"Подключаемся...",lblMessageError:"К сожалению, сообщение не было отправлено по техническим причинам",lblMessageHere:"Введите сообщение",lblNegative:"Плохо",lblNewMessage:"Новое сообщение!",lblNoOperators:"К сожалению, сейчас никто не может ответить",lblOfflineMessageSend:"Сообщение отправлено",lblOperatorsOnline:"Операторы онлайн",lblPencilHint:"Оператор набирает сообщение",lblPhoneHint:"Нажмите «Разрешить», чтобы использовать микрофон компьютера для разговора.\r\nВаша веб-камера использоваться не будет",lblPositive:"Хорошо",lblPwrBy:'Чат предоставлен <a href="http://jivosite.ru/_URL_" target="_blank"><span class="j1">Jivo</span><span class="j2">Site</span></a>',lblReceiveFile:"Принять",lblReopenedElseWhere:"Диалог открыт в другом окне",lblReply:"Ответить",lblSelectDep:"Выберите отдел",lblSend:"Отправить",lblSendBefore:"Начать диалог",lblSendingFile:"_AGENT_ передает Вам файл: _FILE_",lblThanks:"Спасибо!",lblThankYouMessage:"Спасибо за ваше сообщение! Мы&nbsp;обязательно свяжемся с&nbsp;Вами в ближайшее время",lblTransferred:"Диалог передан оператору _AGENT_",lblView:"Посмотреть",lblWaitForOperator:"Пожалуйста ожидайте ответа оператора...",lblWebPhoneFlashError:"Установленная версия Flash не позволяет совершить вызов. Вы можете воспользоваться чатом",lblWebPhoneMicError:"Не удалось подключить микрофон. Пожалуйста, воспользуйтесь чатом",lblWebPhoneNotAvail:"Вызов не возможен из-за проблем с подключением. Пожалуйста, воспользуйтесь чатом",lblWebPhoneNotConnected:"Не удалось установить голосовое соединение. Пожалуйста, воспользуйтесь чатом",lblYourEmail:"Ваш E-mail",lblYourMessage:"Ваше сообщение",lblYourPhone:"Ваш телефон",lnkCloseThisWindow:"Закрыть",lnkRestartChat:"Возобновить",ofl_enterEmail:"Пожалуйста, введите e-mail",ofl_enterMessage:"Пожалуйста, введите сообщение",ofl_enterName:"Пожалуйста, введите имя",ofl_enterValidEmail:"Указан неверный e-mail",ofl_enterValidPhone:"Указан неверный телефон",seo_copyrightTextNew:"Чат предоставлен _JIVOSITE_"},error_sent_cnt=0,CLASS_LIST_SUPPORTED="classList"in document.documentElement,hasClass=CLASS_LIST_SUPPORTED?function(t,e){return t.classList.contains(e)}:function(t,e){return""!==t.className&&underscore.contains(getClasses(t),e)},addClass=CLASS_LIST_SUPPORTED?function(t,e){underscore.each(splitClasses(e),function(e){t.classList.add(e)}),forseRedraw(t)}:function(t,e){var i=getClasses(t),n=underscore.union(i,splitClasses(e));setClasses(t,n)},removeClass=CLASS_LIST_SUPPORTED?function(t,e){underscore.each(splitClasses(e),function(e){t.classList.remove(e)}),forseRedraw(t)}:function(t,e){var i=getClasses(t),n=underscore.difference(i,splitClasses(e));setClasses(t,n)},toggleClass=CLASS_LIST_SUPPORTED?function(t,e,i){e=underscore.uniq(splitClasses(e)),underscore.each(e,function(e){t.classList.toggle(e,i)}),forseRedraw(t)}:function(t,e,i){var n,o=getClasses(t),s=[],a=[];underscore.each(splitClasses(e),function(t){var e=underscore.contains(o,t)?i!==!0&&a:i!==!1&&s;e&&e.push(t)}),n=underscore.union(underscore.difference(o,a),s),setClasses(t,n)},utils={fields:["client_name","phone","email"],phoneReg:/^\+?[0-9() -]+$/i,showAd:function(){return!(8&config.options&&config.hide_ad)},hideOffline:function(){return config.hide_offline>0&&512&config.options},isValidValue_phone:function(t){return t.replace(/\D+/g,"").length>=5&&this.phoneReg.test(t)},isValidValue_mobilePhone:function(t){var e=t.replace(/\D+/g,""),i=-1;return-1!==underscore.indexOf(["7","8"],e.charAt(0))?i=11:"9"===e.charAt(0)&&(i=10),-1!==underscore.indexOf(["7","8","9"],e.charAt(0))&&e.length===i&&this.phoneReg.test(t)},isValidValue_email:function(t){return t.length>=4&&/^.+@.+\..+$/i.test(t)},isValidValue_name:function(t){return t.length>0}};!function(t){if(!t.browser){t.browser={},t.browser.mozilla=!1,t.browser.webkit=!1,t.browser.opera=!1,t.browser.msie=!1;var e=navigator.userAgent;t.browser.ua=e,t.browser.name=navigator.appName,t.browser.fV=""+parseFloat(navigator.appVersion),t.browser.mV=parseInt(navigator.appVersion,10);var i,n,o;if(-1!=(n=e.indexOf("Opera")))t.browser.opera=!0,t.browser.name="Opera",t.browser.fV=e.substring(n+6),-1!=(n=e.indexOf("Version"))&&(t.browser.fV=e.substring(n+8));else if(-1!=(n=e.indexOf("MSIE")))t.browser.msie=!0,t.browser.name="Microsoft Internet Explorer",t.browser.fV=e.substring(n+5);else if(-1!=e.indexOf("Trident")){t.browser.msie=!0,t.browser.name="Microsoft Internet Explorer";var s=e.indexOf("rv:")+3,a=s+4;t.browser.fV=e.substring(s,a)}else-1!=(n=e.indexOf("Chrome"))?(t.browser.webkit=!0,t.browser.name="Chrome",t.browser.fV=e.substring(n+7)):-1!=(n=e.indexOf("Safari"))?(t.browser.webkit=!0,t.browser.name="Safari",t.browser.fV=e.substring(n+7),-1!=(n=e.indexOf("Version"))&&(t.browser.fV=e.substring(n+8))):-1!=(n=e.indexOf("AppleWebkit"))?(t.browser.webkit=!0,t.browser.name="Safari",t.browser.fV=e.substring(n+7),-1!=(n=e.indexOf("Version"))&&(t.browser.fV=e.substring(n+8))):-1!=(n=e.indexOf("Firefox"))?(t.browser.mozilla=!0,t.browser.name="Firefox",t.browser.fV=e.substring(n+8)):(i=e.lastIndexOf(" ")+1)<(n=e.lastIndexOf("/"))&&(t.browser.name=e.substring(i,n),t.browser.fV=e.substring(n+1),t.browser.name.toLowerCase()==t.browser.name.toUpperCase()&&(t.browser.name=navigator.appName));-1!=(o=t.browser.fV.indexOf(";"))&&(t.browser.fV=t.browser.fV.substring(0,o)),-1!=(o=t.browser.fV.indexOf(" "))&&(t.browser.fV=t.browser.fV.substring(0,o)),t.browser.mV=parseInt(""+t.browser.fV,10),isNaN(t.browser.mV)&&(t.browser.fV=""+parseFloat(navigator.appVersion),t.browser.mV=parseInt(navigator.appVersion,10)),t.browser.version=t.browser.mV}}(utils);var ColorConverter={_RGBtoHSV:function(t){var e=new HSV(0,0,0),i=t.r/255,n=t.g/255,o=t.b/255,s=Math.min(i,n,o),a=Math.max(i,n,o),r=a-s;if(e.v=a,0==r)e.h=0,e.s=0;else{e.s=r/a;var c=((a-i)/6+r/2)/r,l=((a-n)/6+r/2)/r,h=((a-o)/6+r/2)/r;i==a?e.h=h-l:n==a?e.h=1/3+c-h:o==a&&(e.h=2/3+l-c),e.h<0&&(e.h+=1),e.h>1&&(e.h-=1)}return e.h=Math.round(360*e.h),e.s=Math.round(100*e.s),e.v=Math.round(100*e.v),e},_HSVtoRGB:function(t){var e=new RGB(0,0,0),i=t.h/360,n=t.s/100,o=t.v/100;if(0==n)e.r=255*o,e.g=255*o,e.b=255*o;else{var s,a,r,c=6*i,l=Math.floor(c),h=o*(1-n),u=o*(1-n*(c-l)),d=o*(1-n*(1-(c-l)));0==l?(s=o,a=d,r=h):1==l?(s=u,a=o,r=h):2==l?(s=h,a=o,r=d):3==l?(s=h,a=u,r=o):4==l?(s=d,a=h,r=o):(s=o,a=h,r=u),e.r=255*s,e.g=255*a,e.b=255*r,e.r=Math.round(e.r),e.g=Math.round(e.g),e.b=Math.round(e.b)}return e},_CMYKtoRGB:function(t){var e=new RGB(0,0,0),i=t.c/100,n=t.m/100,o=t.y/100,s=t.k/100;return e.r=1-Math.min(1,i*(1-s)+s),e.g=1-Math.min(1,n*(1-s)+s),e.b=1-Math.min(1,o*(1-s)+s),e.r=Math.round(255*e.r),e.g=Math.round(255*e.g),e.b=Math.round(255*e.b),e},_RGBtoCMYK:function(t){var e=new CMYK(0,0,0,0),i=t.r/255,n=t.g/255,o=t.b/255;return e.k=Math.min(1-i,1-n,1-o),e.c=(1-i-e.k)/(1-e.k),e.m=(1-n-e.k)/(1-e.k),e.y=(1-o-e.k)/(1-e.k),e.c=Math.round(100*e.c),e.m=Math.round(100*e.m),e.y=Math.round(100*e.y),e.k=Math.round(100*e.k),e},toRGB:function(t){return t instanceof RGB?t:t instanceof HSV?this._HSVtoRGB(t):t instanceof CMYK?this._CMYKtoRGB(t):void 0},toHSV:function(t){return t instanceof HSV?t:t instanceof RGB?this._RGBtoHSV(t):t instanceof CMYK?this._RGBtoHSV(this._CMYKtoRGB(t)):void 0},toCMYK:function(t){return t instanceof CMYK?t:t instanceof RGB?this._RGBtoCMYK(t):t instanceof HSV?this._RGBtoCMYK(this._HSVtoRGB(t)):void 0}};machina.on("newfsm",function(t){t.on("handling",function(t){log(this.namespace+": handling "+t.inputType+" in state "+this.state)}),t.on("nohandler",function(t){log(this.namespace+": unhandled "+t.inputType+" in state "+this.state)}),t.on("transition",function(t){log([this.namespace+":","transition from:",t.fromState,"to:",t.toState,"action:",t.action].join(" "))})});var TimeMachine=machina.Fsm.extend({_fireEvent:function(t){delete this._scheduled_events[t],this.handle(t)},_scheduleEvent:function(t,e){t in this._scheduled_events?log(this.namespace+": attempt to re-schedule event"+t):(log(this.namespace+": scheduling "+t+" for "+e),this._scheduled_events[t]=setTimeout(underscore.bind(this._fireEvent,this,t),e))},_cancelEvent:function(t){t in this._scheduled_events?(clearTimeout(this._scheduled_events[t]),delete this._scheduled_events[t]):log(this.namespace+": attempt to cancel not scheduled event",t)},constructor:function(){this._scheduled_events={},machina.Fsm.apply(this,arguments)}}),TabActions={inited:!1,initialize:function(){this.inited||(_=underscore,this.initScroll(),this.initClose(),this.inited=!0)},initScroll:function(){window.onscroll=_.throttle(_.bind(this._scroll,this),150)},initClose:function(){this.last_position={},window.onmousemove=_.throttle(_.bind(this._mouse,this),150)},_mouse:function(t){if("undefined"!=typeof this.last_position.x){var e=this.last_position.x-t.clientX,i=this.last_position.y-t.clientY;Math.abs(e)>Math.abs(i)&&e>0||Math.abs(e)>Math.abs(i)&&0>e||(Math.abs(i)>Math.abs(e)&&i>0?t.clientY<30&&jivo.handle("move_close_button"):Math.abs(i)>Math.abs(e)&&0>i)}this.last_position={x:t.clientX,y:t.clientY}},_scroll:function(t){var e=(document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;jivo.handle("move_scroll",Math.round(e))}},Rule=TimeMachine.extend({initialize:function(){this.namespace="RULE#"+this.name.replace(" ","_"),this.initialState="unreachable";var t,e=[],i=!1,n=this.commands[0];if(!cookie(n.command+"_onceADay")){for(;t=this.conditions.pop();)if(this.isGoalCondition(t)&&TabActions.initialize(),this.isTimeCondition(t)||this.isGoalCondition(t))e.push(t);else{if("page_url"===t.condition)t.value=t.value.replace("http://","").replace("https://","");else if("ab_test_group"==t.condition&&!cookie("ab_test_group")){var o=Math.round(Math.random()),s=t.group_name?t.group_name:"JivoSite A/B Group";cookie("ab_test_group",o?"group_a":"group_b"),analytics.setABTestGroupContacts(s,o?"Group A":"Group B")}if(this.checkCondition(t))i=!0;else if("all"===this.type)return}return e.length>0?(this.conditions=e,void(this.initialState=this.checkTimeConditions()?"triggered":"time_wait")):void(i&&(this.initialState="triggered"))}},checkTimeConditions:function(){for(var t=!1,e=0;e<this.conditions.length;e++)if(this.checkCondition(this.conditions[e]))t=!0;else if("all"===this.type)return!1;return t},isTimeCondition:function(t){return t.condition.indexOf("time")>=0},isGoalCondition:function(t){return"goal_close"==t.condition||"goal_scroll"==t.condition},checkCondition:function(t){var e=this.getValue(t.condition),i=this.compare(e,t.value,t.comparator);return i||log(this.namespace+": failed condition "+t.condition+"; expected="+t.value+"; actual="+e),i},getValue:function(t){switch(t){case"online":return"online"===config.chat_mode;case"page_url":return window.location.href.replace("http://","").replace("https://","");case"hour":return(new Date).getHours();case"page_title":return document.title;case"week_day":return(new Date).getDay();case"time_after_close":var e=cookie("close_time");return null===e?Number.MAX_VALUE:this.timeDiff(e);case"time_after_first_message":return null!==ruleManager.firstMessageTime?this.timeDiff(ruleManager.firstMessageTime.getTime()):0/0;case"time_after_invitation":var i=cookie("invitation_time");return null===i||""===i?Number.MAX_VALUE:this.timeDiff(i);case"time_on_page":return this.timeDiff(ruleManager.pageEnterTime);case"time_on_site":return this.timeDiff(cookie("enter_ts"));case"number_of_visits":return cookie("visits_count");case"goal_close":return ruleManager.movedToCloseButton;case"goal_scroll":return ruleManager.scrollPosition;default:return cookie(t)}},timeDiff:function(t){return Math.round(((new Date).getTime()-t)/1e3)},compare:function(t,e,i){switch(i){case"contain":return-1!=t.toLowerCase().indexOf(e.toLowerCase());case"greater":return t>e;case"greater_equal":return t>=e;case"lower":return e>t;case"lower_equal":return e>=t;case"not_contain":return-1===t.toLowerCase().indexOf(e.toLowerCase());case"not_equal":return e!=t;case"regexp":return new RegExp(t,"i").test(e);default:return e===t}},states:{time_wait:{_onEnter:function(){this._scheduleEvent("tick",1e3)},tick:function(){this.checkTimeConditions()?this.transition("triggered"):this._scheduleEvent("tick",1e3)},cancel:"unreachable"},unreachable:{},triggered:{_onEnter:function(){var t,e=this.commands[0];if("object"==typeof e.params&&e.params.onceADay&&(t=e.command+"_onceADay"),-1!==underscore.indexOf(["uninitialized","WIDGET"],jivo.gui.state)||-1===underscore.indexOf(["proactive","open_offline","show_callform"],e.command))switch(e.command){case"proactive":ruleManager.showProactive(e.params.message,e.params.department,this.name,t);break;case"open_offline":if("online"===config.chat_mode)return;cookie("invitation_time",(new Date).getTime()),t&&ruleManager.addOnceADayCookie(t),e.params&&(e.params.title&&(config.offline_form_title=e.params.title),e.params.message&&(config.offline_form_text=e.params.message)),jivo.isMobileOrTablet()||setTimeout(underscore.bind(jivo.handle,jivo,"gui_maximize"),0);break;case"hide":jivo.handle("hide");break;case"system_message":jivo.handle("system_message",{message:e.params.message});break;case"show_callform":log(this.namespace+"rule triggered: show_callform",e),ruleManager.showCallForm(e.params.title,t)}}}}}),ruleManager=new TimeMachine({initialState:!1,isInited:!1,namespace:"ruleManager",scrollPosition:!1,movedToCloseButton:!1,init:function(){return log("RULE MANAGER READY"),this.rules=[],underscore.defaults(config,{rules:[]}),this.pageEnterTime=(new Date).getTime(),cookie("pages_count")?cookie("pages_count",parseInt(cookie("pages_count"))+1):cookie("pages_count",1),jivo.on("handling",underscore.bind(this.onJivoHandling,this)),0==config.rules.length&&underscore.isArray(config.proactive_rules)&&config.proactive_rules.length>0?(this.importLegacy(),void this.transition("ready")):this.needGeo()?void this.transition("fetch_geo"):(this.isInited=!0,void this.transition("ready"))},needGeo:function(){for(var t,e,i=0;i<config.rules.length;i++){t=config.rules[i];for(var n=0;n<t.conditions.length;n++)if(e=t.conditions[n],("country"==e.condition||"city"==e.condition)&&null==cookie("country"))return!0}return!1},states:{fetch_geo:{_onEnter:function(){getJSONP(config.base_url+"/script/geo?cb=?",underscore.bind(this.handle,this,"geo_data"))},geo_data:function(t){cookie("country",t.country,{expires:1}),cookie("city",t.city,{expires:1}),this.transition("ready")}},ready:{_onEnter:function(){for(var t=0;t<config.rules.length;t++)this.rules.push(new Rule(config.rules[t]));log(this.namespace+": rules count="+this.rules.length+"; wait count="+underscore.where(this.rules,{state:"time_wait"}).length),this.emit("ready")}}},firstMessageTime:null,canInvite:!0,importLegacy:function(){log(this.namespace+": importing from proactive_rules");for(var t,e=["contain","equal","regexp"],i=0;i<config.proactive_rules.length;i++){t=config.proactive_rules[i],underscore.defaults(t,{name:t.invitationText,urlPrefix:[{url:"/",mm:0}],page_timeout:20,close_timeout:300,enter_timeout:0,pages_count:0});for(var n=0;n<t.urlPrefix.length;n++)config.rules.push({legacyId:t.id,name:t.name,type:"all",conditions:[{condition:"online",value:!0},{condition:"time_on_page",comparator:"greater_equal",value:t.page_timeout},{condition:"time_after_close",comparator:"greater_equal",value:t.close_timeout},{condition:"time_on_site",comparator:"greater_equal",value:t.enter_timeout},{condition:"pages_count",comparator:"greater_equal",value:t.pages_count},{condition:"page_url",comparator:e[t.urlPrefix[n].mm],value:t.urlPrefix[n].url}],commands:[{command:"proactive",params:{message:t.invitationText}}]})}},onJivoHandling:function(t){switch(t.inputType){case"gui_minimize":cookie("close_time",(new Date).getTime());break;case"gui_message":this.firstMessageTime||(this.firstMessageTime=new Date),this.cancelRule("proactive"),this.cancelRule("show_callform");break;case"accept":this.allRulesCancel();break;case"invitation":cookie("invitation_time",(new Date).getTime());break;case"callback_invitation":cookie("invitation_time",(new Date).getTime());break;case"move_close_button":underscore.each(this.rules,function(t){this.movedToCloseButton=!0,t.handle("tick")},this);break;case"move_scroll":underscore.each(this.rules,function(e){this.scrollPosition=t.args,e.handle("tick")},this);break;case"api_open":t.args&&"object"==typeof t.args[0]&&"call"===t.args[0].start&&this.allRulesCancel()}},cancelRule:function(t){log(this.namespace+": cancel "+t);for(var e=0;e<this.rules.length;e+=1)"time_wait"===this.rules[e].state&&this.rules[e].commands[0].command===t&&this.rules[e].handle("cancel");"proactive"===t&&(this.canInvite=!1)},allRulesCancel:function(){for(var t=0;t<this.rules.length;t++)"time_wait"===this.rules[t].state&&this.rules[t].handle("cancel")},restoreAgentInfo:function(){var t=cookie("agent_info");if(t){var e=t.split("$$");return{agent_id:e[0]}}return!1},addOnceADayCookie:function(t){cookie(t,1,{expires:1,path:"/"})},showProactive:function(t,e,i,n){if(this.canInvite){if("number"==typeof t){var o=parseInt(t),s=!1;if(o){for(var a=0;a<this.rules.length;a++)if("proactive"==this.rules[a].commands[0].command&&this.rules[a].legacyId==o){t=this.rules[a].commands[0].params.message,log(this.namespace+": legacy rule found by ID="+o+"; message="+t),s=!0;break}if(!s)return void log(this.namespace+": legacy rule not found by ID="+o)}}var r=this.restoreAgentInfo(),c={name:"active_agent"};e&&config.departments&&underscore.findWhere(config.departments,{id:e})&&(c.department=e),r&&(c.agent_id=r.agent_id),cookie("client_id")&&(c.jv_client_id=cookie("client_id")),getJSONPWithData(chatServerUrl(config.widget_id,config.site_id),c,underscore.bind(function(e){-1!==underscore.indexOf(["uninitialized","WIDGET"],jivo.gui.state)&&(e?(jivo.handle("invitation",{name:i,invitationText:t},e),n&&this.addOnceADayCookie(n)):log("JIVO: invitation failed, no agent"))},this))}},showCallForm:function(t,e){callWidgetPing(underscore.bind(function(i){i.show_form&&-1!==underscore.indexOf(["uninitialized","WIDGET"],jivo.gui.state)&&(log("showCallForm title:"+t),jivo.handle("callback_invitation",{title:t}),jivo.soundPlayer.incomingMessage(),e&&this.addOnceADayCookie(e))},this))}}),_templates={content:underscore.template(["<!DOCTYPE html>","<html>","<head>","<meta charset='utf-8'>","<link rel='stylesheet' href='"+staticUrl("/css/chat.css")+"'/>","<!--[if lte IE 8]>","<link rel='stylesheet' href='"+staticUrl("/css/chat-ie8.css")+"' type='text/css' media='all'/>","<![endif]-->","<meta name='viewport' content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no'>","<title>{{ title }}</title>","</head>","<body id='inner-chat' <% if (jivo.isTablet()) {%>class='tablet-version-widget'<% } %>>","<div id='web_phone' class='phone_hidden'>","<div id='rtc_placeholder'></div>","<div id='up_arrow'></div>","<div id='phone_hint'></div>","</div>","<div id='sound_player'></div>","<div id='contents_placeholder'></div>","<script src='"+staticUrl("/js/chat_"+config.locale+".js")+"' charset='UTF-8'></script>","</body>","</html>"].join("\n")),chat:underscore.template(["<div dir='ltr' class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-chat-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-drag-handle'></div>","<div id='jivo-mouse-tracker' style='display: none'></div>","<div dir='ltr' id='jivo_action' class='jivo-{{ mobile }}'>","<div id='jivo_close_button' data-action='close'></div>","</div>","<div id='jivo_iframe_wrap'>","<div id='jivo_iframe_placeholder'></div>","</div>","<div class='jivo-loader' id='jivo-loader'>","<div class='jivo-loader-title' id='jivo-loader-title'>{{ lblLookingForFreeAgent }}</div>","<div class='jivo-loader-inner'></div>","</div>"].join("\n")),label:{top:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","</div>","</div>","</div>"].join("\n")),bottom:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","</div>","</div>","</div>"].join("\n")),left:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n")),right:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n"))},sound_player:underscore.template(["<source src='{{ mp3 }}' type='audio/mpeg'>","<source src='{{ ogg }}' type='audio/ogg; codecs=vorbis'>","<source src='{{ wav }}' type='audio/wav'>"].join("\n"))},JivoWidget=TimeMachine.extend({namespace:"WIDG",fade:!1,position:{},initialState:"HIDDEN",initialize:function(){this._templateData={orientation:config.widget_orientation,height:config.widget_height,style:config.style_string,text:"online"==config.chat_mode?config.online_widget_label:config.offline_widget_label,type:config.widget_font_color,locale:getIconLocale()},this._widgetDiv=document.createElement("div"),this._widgetDiv.onclick=underscore.bind(this.handle,this,"click"),this._widgetDiv.setAttribute("id","jivo_chat_widget"),log(this._widgetDiv,_templates,config.widget_orientation,this._templateData),this._widgetDiv.innerHTML=_templates.label[config.widget_orientation](this._templateData),this.topWrap.appendChild(this._widgetDiv),this._el=document.getElementById("jivo-label"),this.setColor(),this.setFontStyle(),this.setPosition()},isCustom:function(){var t=this._widgetDiv.currentStyle?this._widgetDiv.currentStyle.display:getComputedStyle(this._widgetDiv,null).display;return"none"===t},states:{VISIBLE:{_onEnter:function(){jivo.transferProportion({width:document.getElementById("jivo-label").offsetWidth,height:config.widget_height-0}),this._el.style.display="block",this._hideLabelForCallWidget||(this._el.style.visibility="visible"),this.fade&&addClass(this._el,"jivo-fade-in")},click:function(){jivo.isClicked=!0,jivo.handle("gui_maximize")},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){removeClass(this._el,"jivo-fade-in"),this._el.style.visibility="hidden"},show:"VISIBLE",hide:function(){}}},getOffset:function(t){for(var e=0,i=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,i+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{top:i,left:e}},setText:function(t){if(this._widgetDiv){var e;underscore.indexOf(["right","left"],config.widget_orientation)>=0?(e=document.getElementById("jivo-text-container"),e=e.getElementsByTagName("div")[0]):e=document.getElementById("jivo-label-text"),
e.innerHTML=t,this.setPosition(),this.position=getElementPosition(this._el)}},setColor:function(){this._containerDiv=document.getElementById("jivo-label-wrapper"),this._textContainer=document.getElementById("jivo-label-text");for(var t=getElementsByClassName("jivo-label-triangle"),e=0;e<t.length;e++)switch(config.widget_orientation){case"top":t[e].style.borderTopColor=config.widget_color;break;case"bottom":t[e].style.borderLeftColor=config.widget_color;break;case"right":t[e].style.borderBottomColor=config.widget_color;break;case"left":t[e].style.borderLeftColor=config.widget_color}for(var t=getElementsByClassName("jivo-triangle-inner"),e=0;e<t.length;e++)t[e].style.backgroundColor=config.widget_color;if(this._containerDiv){if(this._textContainer.style.fontSize=config.font_size+"px",this._textContainer.style.fontFamily=config.font_family,this._isDarkText="dark"==config.widget_font_color,this._isDarkText)var i="#222222";else var i="#F0F1F1";this._textContainer.style.color=i}},setOffline:function(){document.getElementById("jivo_chat_widget_online").setAttribute("id","jivo_chat_widget_offline"),this.setText(config.offline_widget_label);for(var t=getElementsByClassName("jivo-bottom-left-square"),e=0;e<t.length;e+=1)t[e].style.backgroundColor=config.widget_color},setOnline:function(){addClass(this._el,"jivo-online"),removeClass(this._el,"jivo-offline"),this.setText(config.online_widget_label);for(var t=getElementsByClassName("jivo-bottom-left-square"),e=0;e<t.length;e+=1)t[e].style.backgroundColor="#44bb6e";for(t=getElementsByClassName("jivo-css-leaf"),e=0;e<t.length;e+=1)removeClass(t[e],"jivo-offline"),addClass(t[e],"jivo-online")},setPosition:function(){var t=getElementPosition(this._el),e=30,i=10;switch(config.widget_orientation){case"left":case"right":var n=document.getElementById("jivo-text-container"),o=n.getElementsByTagName("div")[0];switch(o.offsetWidth<o.offsetHeight?(n.style.width=o.offsetWidth+"px",n.style.height=o.offsetHeight+"px"):(n.style.width=o.offsetHeight+"px",n.style.height=o.offsetWidth+"px"),t=getElementPosition(this._el),config.widget_padding){case"0":e=-30;break;case"50":e=t.height/2;break;case"100":e=t.height+i}this._el.style.top=config.widget_padding+"%",this._el.style.marginTop=-1*e+"px",this._el.style.width=config.widget_height+"px";break;case"top":case"bottom":switch(config.widget_padding){case"0":e=-30;break;case"50":e=t.width/2;break;case"100":e=t.width+i}"100"==config.widget_padding?(this._el.style.left="",this._el.style.right="30px"):(this._el.style.left=config.widget_padding+"%",this._el.style.right="",this._el.style.marginLeft=-1*e+"px"),this._el.style.height=config.widget_height+"px"}},setFontStyle:function(){var t=document.getElementById("jivo-label-text");switch(config.font_type){case"normal":t.style.fontWeight="normal",t.style.fontStyle="normal";break;case"italic":t.style.fontWeight="normal",t.style.fontStyle="italic";break;case"bold":t.style.fontWeight="bold",t.style.fontStyle="normal";break;case"bold italic":t.style.fontWeight="bold",t.style.fontStyle="italic"}t.style.fontSize=config.font_size},getPosition:function(){return getElementPosition(document.getElementById("jivo-label"))}}),JivoChatTop=TimeMachine.extend({namespace:"CHAT",mode:"online",_scrollOffset:0,_manualyScrolled:0,_chatDiv:0,_iframe:0,_iframeWrap:0,_doc:0,_window:0,_backgroundColor:0,_borderColor:0,_bodyColor:0,_onload_semaphore:!1,_event_queue:[],_guiState:null,_getDoc:function(){return this._iframe.contentDocument?this._iframe.contentDocument:this._iframe.contentWindow?this._iframe.contentWindow.document:(log("WARNING! chat_iframe._doc is null"),0)},iframeLoaded:function(){if(this._onload_semaphore){removeEvent(window,"scroll",this._onWindowScroll);try{this._window.chat_contents.init(this.mode,this.open_params,jivo.isClicked),jivo.isClicked=!1}catch(t){return void log("CHAT: iframe loaded, but contents is unreachable")}this.handle("iframe_ready")}else this._onload_semaphore=!0;devicejs.chrome()&&(document.body.scrollTop=this._manualyScrolled||this._scrollOffset)},_onWindowScroll:null,setColor:function(){this._isDarkText="dark"==config.widget_font_color,this._backgroundColor=config.widget_color,this._borderColor=adjustLightness(this._backgroundColor,.6,1),this._bodyColor=adjustLightness(this._backgroundColor,1.15,.5);var t=document.getElementById("jivo-chat");if(t){var e,i;this._isDarkText?(e=adjustLightness(this._backgroundColor,1.15,.7)+" 0 1px",i=adjustLightness(this._backgroundColor,.1,.5)):(e=adjustLightness(this._backgroundColor,.6,1)+" 0 -1px",i="#ffffff"),document.getElementById("jivo-loader-title").style.color=i}},setChatHeight:function(t){var e=document.getElementById("jivo-chat");log("Setting chat height: "+t),jivo.transferProportion({width:e.offsetWidth,height:t}),this._chatDiv.style.height=t+"px"},hide:function(){this._iframe.style.display="none",this._iframe.style.visibility="hidden",this._chatDiv.style.visibility="hidden",removeClass(this._chatDiv,"jivo-fade-in")},show:function(){this._iframe.style.display="block",this._iframe.style.visibility="visible",this._chatDiv.style.visibility="visible",addClass(this._chatDiv,"jivo-fade-in")},getInitPosition:function(){var t={},e="top"==config.widget_orientation||"bottom"==config.widget_orientation;return"left"==config.widget_orientation||e&&0==config.widget_padding?t.left="30px":t.right="30px","online"===config.chat_mode?(cookie("left")&&(t.left=cookie("left")),cookie("right")&&(t.right=cookie("right")),cookie("height")?t.height=cookie("height"):1==config.contacts_ask&&(t.height=this.getOnlineFormHeight())):t.height=this.getOfflineFormHeight(),jivo.isTablet()&&!jivo.isSeparateWindow()&&(t.height=350),t},getOfflineFormHeight:function(){var t=this.getOfflineDescriptionHeight();return t+=JivoChatTop.MESSAGE_OFFLINE_HEIGHT+JivoChatTop.INPUT_MARGIN,!config.contacts_settings.email.show&&config.contacts_settings.phone.show&&config.contacts_settings.phone.required||(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.contacts_settings.name.show&&(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.contacts_settings.phone.show&&(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),8&config.options&&config.hide_ad||(t+=JivoChatTop.ADWORD_HEIGHT),t+=2*JivoChatTop.INNER_PADDING,t+=JivoChatTop.HEADER_OFFLINE_HEIGHT,t+=JivoChatTop.BUTTONS_HEIGHT,t+"px"},getOfflineDescriptionHeight:function(){var t,e=document.createElement("div");return e.style.position="absolute",e.style.fontSize="16px",e.style.fontFamily="Arial, sans-serif",e.style.lineHeight="19px",e.style.visibility="hidden",e.style.width="247px",e.innerHTML=config.offline_form_text,document.body.appendChild(e),t=e.offsetHeight+JivoChatTop.DESCRIPTION_MARGIN,document.body.removeChild(e),t},getOnlineFormHeight:function(){var t=JivoChatTop.MESSAGE_ONLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;return config.contacts_settings.email.show&&(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN,config.contacts_settings.phone.show&&(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.departments&&(t+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),8&config.options&&config.hide_ad||(t+=JivoChatTop.ADWORD_HEIGHT),t+=JivoChatTop.INNER_PADDING,t+=JivoChatTop.HEADER_ONLINE_HEIGHT,t+=JivoChatTop.BUTTONS_HEIGHT,t+=JivoChatTop.AVATAR_MARGIN,Math.max(JivoChatTop.MIN_HEIGHT,t)+"px"},getPosition:function(){return getElementPosition(this._chatDiv)},getGuiState:function(){this._guiState=cookie("gui_state")},initialize:function(){this._onWindowScroll=underscore.bind(function(){this._manualyScrolled=document.body.scrollTop},this);var t,e,i;this._chatDiv=document.createElement("div"),this._chatDiv.setAttribute("id","jivo-chat");var n=this.getInitPosition();for(e in n)this._chatDiv.style[e]=n[e];for(t="mobile",this._chatDiv.innerHTML=_templates.chat({chatMode:config.chat_mode,mobile:"desktop",lblLookingForFreeAgent:translate("lblLookingForFreeAgent")}),this.topWrap.appendChild(this._chatDiv),this.setColor(),i=getElementsByClassName("jivo-chat-triangle"),e=0;e<i.length;e++)i[e].style.borderLeftColor=config.widget_color;for(i=getElementsByClassName("jivo-triangle-inner"),e=0;e<i.length;e++)i[e].style.backgroundColor=config.widget_color;var o;for(o="offline"===config.chat_mode&&"offline"===jivo.gui.mode?config.widget_color:"#44bb6e",i=getElementsByClassName("jivo-bottom-left-square"),e=0;e<i.length;e+=1)i[e].style.backgroundColor=o},states:{uninitialized:{show:function(t,e){this.getGuiState(),this.mode=t,this.open_params=e,this.transition("LOADING_IFRAME")},resume_ok:function(t){this.getGuiState(),this._event_queue.push(["resume_ok"].concat(underscore.toArray(arguments)));var e=t.client_info&&t.client_info.msg_history,i=config.chat_mode;e&&e.length>0&&(i="online"),this.mode=i,this.transition("LOADING_IFRAME")},invitation:function(t,e){this.getGuiState(),this._event_queue.push(["accept",{agent_info:t}]),this._event_queue.push(["agent_message",{message:e,invitation:!0}]),this.mode="online",this.transition("LOADING_IFRAME")}},LOADING_IFRAME:{_onEnter:function(){this._scrollOffset=document.body.scrollTop||0,addListener(window,"scroll",this._onWindowScroll),"CHAT"===this._guiState&&(this._chatDiv.style.visibility="visible",addClass(this._chatDiv,"jivo-fade-in")),this._iframe=document.createElement("iframe"),this._iframe.setAttribute("id","jivo_chat_iframe"),this._iframe.setAttribute("frameBorder","0"),this._iframe.setAttribute("scrolling","no"),this._iframe.allowTransparency=!0,this._iframe.style.visibility="hidden",this._iframeWrap=document.getElementById("jivo_iframe_placeholder"),this._iframeWrap.appendChild(this._iframe),setIframeLoadCallback(this._iframe,underscore.bind(this.iframeLoaded,this)),this._doc=this._getDoc(),this._doc.open();var t={title:window.document.title,lblPhoneHint:translate("lblPhoneHint")};this._doc.write(_templates.content(t)),this._doc.close(),this._window=this._iframe.contentWindow,this.iframeLoaded(),addClass(this._chatDiv,"jivo-animated jivo-"+config.chat_mode)},iframe_ready:function(){delete this.open_params,jivo.gui.animationIsSupported()?(addClass(document.getElementById("jivo-loader"),"jivo-fade-out"),addClass(this._iframe,"jivo-fade-in")):document.getElementById("jivo-loader").style.display="none";for(var t=0;t<this._event_queue.length;t++){var e=this._event_queue[t];this._window.chat_contents.handle.apply(this._window.chat_contents,e)}this._event_queue=[],this.transition("CHAT"===this._guiState?"VISIBLE":"HIDDEN")},update_height:function(t){this.setChatHeight(t)},"*":function(){this._event_queue.push(underscore.toArray(arguments))},invitation:function(t,e){this._event_queue.push(["accept",{agent_info:t}]),this._event_queue.push(["agent_message",{message:e,invitation:!0}]),this.mode="online"}},VISIBLE:{_onEnter:function(){var t=document.getElementById("jivo-chat");jivo.transferProportion({width:t.offsetWidth,height:t.offsetHeight}),this.show()},hide:function(){this.transition("HIDDEN")},update_height:function(t){this.setChatHeight(t)},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))},invitation:function(t,e){this._window.chat_contents.handle("accept",{agent_info:t}),this._window.chat_contents.handle("agent_message",{message:e,invitation:!0})}},HIDDEN:{_onEnter:function(){this.hide()},show:function(t,e){this.transition("VISIBLE"),this._window.chat_contents.handle(jivo.isClicked?"focus_maximize":"maximize",e||t),jivo.isClicked=!1},invitation:function(t,e){this._window.chat_contents.handle("accept",{agent_info:t}),this._window.chat_contents.handle("agent_message",{message:e,invitation:!0}),this.transition("VISIBLE")},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))}}}},{INPUT_MARGIN:10,INPUT_HEIGTH:30,MESSAGE_OFFLINE_HEIGHT:109,BUTTONS_HEIGHT:28,HEADER_OFFLINE_HEIGHT:60,INNER_PADDING:10,ADWORD_HEIGHT:30,MESSAGE_ONLINE_HEIGHT:84,HEADER_ONLINE_HEIGHT:75,AVATAR_MARGIN:20,MIN_HEIGHT:372,DESCRIPTION_MARGIN:20}),JivoGui=TimeMachine.extend({namespace:"GUI",mode:"online",animate:!1,unreadMessages:0,setCookie:!0,_event_queue:[],setOnline:function(){return this.widget.setOnline(),this.mode="online",this},setOffline:function(){return"offline"!=this.mode&&(this._setButtonsOffline(),this.widget.setOffline(),this.mode="offline"),this},showWidget:function(t,e){return this.enableAnimation(!!t),this.setCookie=void 0==e?!0:!!e,this.handle("minimize"),this},showChat:function(t,e){return jivo.isMobileOrTablet()?this.openNewWindow():(this.enableAnimation(!!t),this.handle("maximize",e)),this},showCallWidget:function(){this.widget._hideLabelForCallWidget=!0,this.widget._el.style.visibility="hidden","top"===config.widget_orientation||"bottom"===config.widget_orientation?this.widget._el.style.height=0:this.widget._el.style.width=0,this.handle("callwidget")},showInvitation:function(t,e){return this.handle("invitation",t,e),this},showLabelForCallWidget:function(){this.widget._hideLabelForCallWidget=!1,"VISIBLE"===this.widget.state&&(this.widget._el.style.visibility="visible"),"top"===config.widget_orientation||"bottom"===config.widget_orientation?this.widget._el.style.height=config.widget_height+"px":this.widget._el.style.width=config.widget_height+"px"},openNewWindow:function(){var t,e=window.location.protocol,i=e+jivo_config.base_url+"/script/window/"+jivo_config.widget_id,n=[],o=["client_id"];"online"===jivo_config.chat_mode&&o.push("sess_id");for(var s=0;s<o.length;s++)cookie(o[s])&&n.push(o[s]+"="+cookie(o[s]));t=jivo.getCurrentPage(),n.push("url="+encodeURIComponent(t.url)),n.push("title="+encodeURIComponent(t.title)),n.length&&(i+="?"+n.join("&"));var a;jivo.isTablet()&&jivo.checkVisibilityAPI?a=window.open(i,"jivo_"+config.widget_id):window.location=i,a&&a.focus()},getChatTop:function(){return this.chat_top||(this.chat_top=new JivoChatTop({topWrap:this._wrapDiv})),this.chat_top},chatInitialized:function(){return!!this.chat_top},incrementCounter:function(){var t=document.getElementById("jivo-label-indicator");t.innerHTML=++this.unreadMessages,t.style.visibility="visible"},resetCounter:function(){var t=document.getElementById("jivo-label-indicator");this.unreadMessages=0,t.style.visibility="hidden"},_setButtonsOffline:function(){for(var t=!1,e=getElementsByClassName("jivo-btn jivo-online-btn"),i=0;i<e.length;i++)t||(t=e[i].style.display),e[i].style.display="none";for(e=getElementsByClassName("jivo-btn jivo-offline-btn"),i=0;i<e.length;i++)e[i].style.display=t},highlight:function(t){var e=config.base_url+"/script/cobrowsing?cb=?&hash="+t;getJSONP(e,function(t){underscore.isObject(t)&&(0==t.comment.length&&(t.comment=translate("lblDefaultCobrowseComment")),t.comment=stripBrackets(t.comment),childSandboxBridge.process("highlight",t),childSandboxBridge.process("renderTooltip",t))})},initialize:function(){this._wrapDiv=document.createElement("div"),this._wrapDiv.setAttribute("id","jivo_top_wrap"),document.body.appendChild(this._wrapDiv),underscore.defaults(config,{online_widget_label:translate("defOnlineWidgetLabel"),offline_widget_label:translate("defOfflineWidgetLabel"),offline_form_text:translate("defOfflineFormText"),contacts_settings:{name:{show:!1,required:!1},phone:{show:!1,required:!1},email:{show:!1,required:!1}}}),getConfigContactsAsk(),jivo.isMobile()&&(config.online_widget_label=translate("defOnlineWidgetLabelMobile")||config.online_widget_label,config.offline_widget_label=translate("defOfflineWidgetLabelMobile")||config.offline_widget_label,config.widget_orientation="bottom",config.widget_padding=100,config.ignore_viewport&&(jivo.ignore_viewport=config.ignore_viewport)),jivo.isWixIframe()&&(config.widget_orientation="bottom"),this.widget=new JivoWidget({topWrap:this._wrapDiv}),this.copyright=new JivoCopyright,this.animationIsSupported()&&(this.phantom=new JivoPhantom({topWrap:this._wrapDiv}),this.phantom.on("animated",underscore.bind(this.handle,this,"animate_finished")))},enableAnimation:function(t){!jivo.isWixIframe()&&t?(log("GUI : enabling animation"),this.animate=!0):(log("GUI : disabling animation"),this.animate=!1)},animationIsSupported:function(){return!(this.widget.isCustom()||!css3AnimationIsSupported())},states:{uninitialized:{minimize:"WIDGET",maximize:function(){this._event_queue.push(["show",this.mode]),this.transition("CHAT")},blacklist:"INVISIBLE",resume_ok:function(t){var e=t.client_info.msg_history;if(this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments))),underscore.findWhere(e,{type:"agentMessage",ack:0}))return void this.transition("CHAT");var i=cookie("gui_state"),n=t.client_info.cw_call&&t.client_info.cw_call.status;(!i||"CALLWIDGET"===i&&!n||"CALLWIDGET"===i&&"cw_call_end"===n)&&(i="WIDGET"),this.transition(i)}},WIDGET:{_onEnter:function(){this.setCookie&&cookie("gui_state","WIDGET"),connection.updateClient({chat_opened:!1}),this.chatInitialized()&&this.getChatTop().handle("hide"),this.widget.handle("show")},maximize:function(t){this.resetCounter(),this._event_queue.push(["show",this.mode,t]),this.transition(this.animationIsSupported()&&this.animate?"ANIMATE_EXPAND":"CHAT")},callwidget:function(){this.transition("CALLWIDGET")},"*":function(t){jivo.isMobile()||jivo.isAndroid4old()&&jivo.isTablet()?underscore.indexOf(["agent_message","system_message","invitation","agent_service_message"],t)>=0&&underscore.indexOf(["agent_message","invitation","agent_service_message"],t)>=0&&this.incrementCounter():("invitation"!==t&&this._event_queue.push(["show",this.mode]),this._event_queue.push(underscore.toArray(arguments)),underscore.indexOf(["agent_message","invitation","agent_service_message"],t)>=0?this.transition(this.animationIsSupported()?"ANIMATE_EXPAND":"CHAT"):"resume_ok"===t&&(!this.chat_top||this.chat_top&&cookie("gui_state")&&"CHAT"===cookie("gui_state"))&&this.transition("CHAT"))},blacklist:function(){this.widget.handle("hide"),this.transition("INVISIBLE")}},CHAT:{_onEnter:function(){this.setCookie&&cookie("gui_state","CHAT"),connection.updateClient({chat_opened:!0}),this.widget.handle("hide"),jivo.getCallWidget()&&jivo.cw.callwidget.hideCallWidget();var t;for(jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height});t=this._event_queue.shift();)this.getChatTop().handle.apply(this.getChatTop(),t);this.widget.fade||(this.widget.fade=!0)},minimize:function(){this.transition(this.animationIsSupported()&&this.animate?"ANIMATE_COLLAPSE":"WIDGET")},callwidget:function(){this.transition("CALLWIDGET")},"*":function(t){this.getChatTop().handle.apply(this.getChatTop(),underscore.toArray(arguments)),"resume_ok"===t&&cookie("gui_state")&&"WIDGET"===cookie("gui_state")&&this.transition("WIDGET")},blacklist:function(){this.getChatTop().handle("hide")}},CALLWIDGET:{_onEnter:function(){this.setCookie&&cookie("gui_state","CALLWIDGET"),connection.updateClient({chat_opened:!1}),this.chatInitialized()&&this.getChatTop().handle("hide"),this.widget.handle("hide"),this.widget.fade||(this.widget.fade=!0)},minimize:function(){this.transition("WIDGET")},maximize:function(t){this._event_queue.push(["show",t?t:this.mode]),this.transition(this.animationIsSupported()&&this.animate?"ANIMATE_EXPAND":"CHAT")},"*":function(t){this._event_queue.push(underscore.toArray(arguments)),"agent_message"===t?this.handle("maximize"):"resume_ok"===t&&"CLOSED"===jivo.getCallWidget().state&&this.transition("WIDGET")},blacklist:function(){this.getChatTop().handle("hide")}},ANIMATE_EXPAND:{_onEnter:function(){jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height}),this.phantom.transition("HIDDEN"),this.phantom.handle("expand",this.widget.getPosition(),this.getChatTop().getPosition()),this.widget.handle("hide")},animate_finished:"CHAT",resume_ok:function(){this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)))},"*":function(t,e){this._event_queue.push(underscore.toArray(arguments))},blacklist:"INVISIBLE"},ANIMATE_COLLAPSE:{_onEnter:function(){jivo.transferProportion({width:this.widget.getPosition().width,height:this.widget.getPosition().height}),this.phantom.handle("collapse",this.widget.getPosition(),this.getChatTop().getPosition()),this.getChatTop().hide()},"*":function(t,e){this._event_queue.push(underscore.toArray(arguments))},animate_finished:"WIDGET",blacklist:"INVISIBLE"},INVISIBLE:{animate_finished:function(){this.widget.handle("hide"),this.getChatTop().handle("hide")}}}}),JivoCopyright=TimeMachine.extend({namespace:"AD",initialState:"HIDDEN",disabled:!1,initialize:function(){var t=document.getElementById("jivo-label-copyright");if(!utils.showAd())return addClass(t,"jivo-no-copyright"),void(this.disabled=!0);if(this.jivo_copyright=document.getElementById("jivo_copyright"),!this.jivo_copyright){this.jivo_copyright=document.createElement("div");var e="en"===config.iconLocale?"com":"ru";this.jivo_copyright.innerHTML=translate("seo_copyrightTextNew").replace("_JIVOSITE_","<a href='http://jivo"+("en"===config.iconLocale?"chat.":"site.")+e+"' target='_blank' id='jivosite-copyright' class='jivo-"+config.widget_font_color+" jivo-"+config.iconLocale+"'></a>"),this.jivo_copyright.id="jivo_copyright",this.jivo_copyright.style.display="none",document.body.appendChild(this.jivo_copyright)}var i=document.createElement("div");switch(i.setAttribute("id","jivo_copyright_corner"),i.setAttribute("class","jivo-"+config.widget_orientation),config.widget_orientation){case"top":i.style.borderBottomColor=config.widget_color;break;case"left":i.style.borderRightColor=config.widget_color;break;case"right":i.style.borderLeftColor=config.widget_color;break;case"bottom":i.style.borderTopColor=config.widget_color}this.jivo_copyright.style.backgroundColor=config.widget_color,this.jivo_copyright.appendChild(i);for(var n=this.jivo_copyright.getElementsByTagName("a"),o=0;o<n.length;o++)n[o].href+="?utm_source="+encodeURIComponent(location.hostname)+"&utm_medium=link&utm_content=widget_popup&utm_campaign=self_ad";jivo.isMobile()||(t.onmouseover=underscore.bind(this.handle,this,"ad_mouseover"),t.onmouseout=underscore.bind(this.handle,this,"ad_mouseout"),this.jivo_copyright.onmouseover=underscore.bind(this.handle,this,"copyright_mouseover"),this.jivo_copyright.onmouseout=underscore.bind(this.handle,this,"copyright_mouseout"))},getTooltipPosition:function(t){var e=getElementPosition(t),i=getElementPosition(document.getElementById("jivo_copyright")),n={top:0,left:0};switch(config.widget_orientation){case"left":n={top:e.top+20,left:e.left+e.width+10},ie8&&(n={top:e.top,left:e.left+e.width+10});break;case"right":n={top:e.top+20,left:e.left-i.width-10};break;case"top":n={top:e.top+(e.height+15),left:e.left+40};break;case"bottom":n={bottom:e.height+10,left:e.left+(e.width-i.width)-40}}return n},states:{HIDDEN:{_onEnter:function(){this.disabled||(this.jivo_copyright.style.display="none")},ad_mouseover:"VISIBLE"},VISIBLE:{_onEnter:function(){this.jivo_copyright.style.display="block";var t=this.getTooltipPosition(document.getElementById("jivo-label"));this.jivo_copyright.style.left=t.left+"px","undefined"!=typeof t.bottom?this.jivo_copyright.style.bottom=t.bottom+"px":this.jivo_copyright.style.top=t.top+"px"},ad_mouseout:function(){this._scheduleEvent("hide",700)},hide:"HIDDEN",copyright_mouseover:function(){this._cancelEvent("hide")},copyright_mouseout:function(){this._scheduleEvent("hide",700)}}}}),jivoTitle=new TimeMachine({namespace:"TITLE",title:"",startBlink:function(){this.handle("start")},stopBlink:function(){this.handle("stop")},_messageShown:!1,_showMessage:function(){document.title=translate("lblNewMessage"),this._messageShown=!0},_showTitle:function(){document.title=this.title,this._messageShown=!1},states:{uninitialized:{start:"blinking"},blinking:{_onEnter:function(){this.title=document.title,this._showMessage(),this._scheduleEvent("blink",1e3)},blink:function(){this._messageShown?this._showTitle():this._showMessage(),this._scheduleEvent("blink",1e3)},stop:function(){this._showTitle(),this._cancelEvent("blink"),this.transition("uninitialized")}}}}),jivo=window.jivo=new TimeMachine({namespace:"JIVO",_chatWindow:!1,_forcedCurrentPage:!1,_forcedOffline:!1,checkVisibilityAPI:!0,invitationText:!1,agentInfo:!1,ruleName:!1,isClicked:!1,initialize:function(){var t=underscore.bind(this.handle,this,"window.loaded");if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir)var e=setInterval(function(){log("check for document.readyState: "+document.readyState),("complete"===document.readyState||"loaded"===document.readyState)&&(jivo.handle("window.loaded"),clearInterval(e))},300);else"complete"===document.readyState?setTimeout(t):document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",t),window.attachEvent("onload",t)),this.device=devicejs},initializeMachines:function(){this.gui=new JivoGui,!config.callback_widget||this.cw||this.isMobileOrTablet()||this.initCallWidget(),this.soundPlayer=soundPlayer,this.soundPlayer.initialize(document.getElementById("jivo_top_wrap"))},_changeBrowserLocation:function(t,e){"function"==typeof window.parent.history.pushState&&window.parent.history.pushState({},e,t)},_newSession:function(){if(cookie("sess_id",null),!this.isSeparateWindow()){if("offline"===config.chat_mode&&utils.hideOffline())return void this.transition("HIDDEN");if(16&config.options)return void this.transition("INIT_RULE_MANAGER");"online"===config.chat_mode?(this.isVisitorsInsight()&&connection.handle("startup"),this.transition("ONLINE")):this.transition("OFFLINE")}this.gui.showWidget()},_listenMessages:function(t){log("JIVO: listening for window messages"),"addEventListener"in window?window.addEventListener("message",underscore.bind(this._windowMessage,this,t),!1):"attachEvent"in window&&window.attachEvent("message",underscore.bind(this._windowMessage,this,t))},_windowMessage:function(t,e){this.handle([t,e.data.action].join("_"),e)},isVisitorsInsight:function(){return 1===config.visitors_insight},isMobile:function(){return devicejs.mobile()},isTablet:function(){return devicejs.tablet()},isMobileOrTablet:function(){return this.isMobile()||this.isTablet()},isAndroid4old:function(){var t,e=navigator.userAgent,i=!1;return e.indexOf("Android")>=0&&(t=parseFloat(e.slice(e.indexOf("Android")+8)),(4===t||4.1===t||4.2===t)&&(i=!0)),i},isWixIframe:function(){return"undefined"!=typeof jivo_in_wix_iframe},isSeparateWindow:function(){return"undefined"!=typeof jivo_newWindow},getCallWidget:function(){return this.cw&&this.cw.callwidget},initCallWidget:function(){var t={currentState:"",position:{top:0,left:0},seconds:config.callback_widget,initTimer:config.callback_widget,agent_info:""};this.resumed_context&&this.resumed_context.client_info.cw_call?(t.currentState=jivo.resumed_context.client_info.cw_call.status,("cw_call_end"===t.currentState||"cw_error"===t.currentState)&&(t.currentState="CLOSED"),t.agent_info=this.resumed_context.agent_info):t.agent_info=null,t.currentState&&(-1!==underscore.indexOf(["cw_connected","cw_connecting","cw_error","cw_call_end"],t.currentState)?(t.initialState="CALL",t.priorAction=t.currentState):(t.initialState="WAIT",t.priorAction=t.currentState)),"CLOSED"===t.currentState&&(t.initialState="CLOSED"),this.cw||(this.cw={}),this.cw.callwidget=new CallWidget(t),log("jivo.js init cw")},createMagicIFrame:function(){this.isMobile()||this.isTablet()||this.isSeparateWindow()||this.isWixIframe()||site_iframe.create()},_callUserFunction:function(t,e){if(t="jivo_"+t,"function"==typeof window[t])try{log("JIVO: calling user function "+t),window[t](e),log("JIVO: user function "+t+" returned")}catch(i){}},_sendIntroduce:function(t){connection.sendIfConnected({name:"introduction",client_name:t.name,phone:t.phone,email:t.email}),this._saveClientInfo(t)},_saveClientInfo:function(t){underscore.each(["name","phone","email"],function(e){e in t&&""!==t[e]&&("name"===e?cookie("client_name",t[e],{expires:365,path:"/"}):cookie(e,t[e],{expires:365,path:"/"}))})},_chatAccepted:function(){analytics.trackChatConnected(),this._callUserFunction("onAccepted")},transferProportion:function(t){this._callUserFunction("onResizeCallback",t)},getCurrentPage:function(){return this._forcedCurrentPage?this._forcedCurrentPage:{url:window.location.href,title:setSubstrTitle(document.title)}},getChatHeight:function(){return document.getElementById("jivo-chat").offsetHeight},_stripHashFromLocation:function(t){window.location.href.indexOf("#jvhs_"+t)>0&&this._changeBrowserLocation(window.location.href.replace("#jvhs_"+t,""),document.title)},_pageVisible:function(){return"visibilityState"in document?"visible"===document.visibilityState:"webkitVisibilityState"in document?"visible"===document.webkitVisibilityState:!1},_listenVisibility:function(){log("Installing visibility event handler");var t,e,i;"undefined"!=typeof document.hidden?(t="hidden",i="visibilitychange",e="visibilityState"):"undefined"!=typeof document.mozHidden?(t="mozHidden",i="mozvisibilitychange",e="mozVisibilityState"):"undefined"!=typeof document.msHidden?(t="msHidden",i="msvisibilitychange",e="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",i="webkitvisibilitychange",e="webkitVisibilityState"),"addEventListener"in document&&"undefined"!=typeof i?document.addEventListener(i,underscore.bind(this._visibleHandler,this,e),!1):this.checkVisibilityAPI=!1},_visibleHandler:function(t){this.handle("window_"+document[t]),connection.updateClient({page_visible:this._pageVisible()})},_isBlacklisted:function(){var t=cookie("client_id");return t&&0===t.indexOf("z")},_inAir:function(){return window.parentSandboxBridge&&window.parentSandboxBridge.inAir},_sendRate:function(t,e){var i={jv_sess_id:e,r:t};getJSONPWithData(config.base_url+"/script/rate/"+config.widget_id,i,function(t){log("Rate result",t)})},handleGuiTransition:function(t){"WIDGET"===t.toState?this._callUserFunction("onClose"):"CHAT"===t.toState&&this._callUserFunction("onOpen")},callWidgetEvents:function(t,e){if(0===t.lastIndexOf("cw_",0))if(log(t,this.state,underscore.toArray(arguments)),this.cw){if("cw_cancel_call"===t)return void connection.send({name:t});"cw_call"===t?connection.send({name:t,tel:e.tel,invitation_text:e.invitation_text||!1}):"cw_ping"===t?connection.send({name:t,title:underscore.toArray(arguments)[1]||!1}):this.emit.apply(this,underscore.toArray(arguments))}else log("JIVO: Call widget not initialized.")},updateHeight:function(t){"update_height"===t&&this.gui.handle.apply(this.gui,underscore.toArray(arguments))},"*":function(t,e){this.updateHeight(t,e),log(this.namespace+": unhandled "+t+" in state "+this.state)},states:{uninitialized:{"window.loaded":function(){if(!cookie("enter_ts")){cookie("enter_ts",(new Date).getTime()),document.referrer&&(cookie("refer",document.referrer),setUTMParams(window.location.href));var t=cookie("visits_count")-0;cookie("visits_count",t?t+1:1,{expires:365,path:"/"})}if(this.isSeparateWindow()){this._listenVisibility();var e=getURLParam("url"),i=getURLParam("title");e&&i&&(this._forcedCurrentPage={url:e,title:setSubstrTitle(i)});var n=getURLParam("client_id");n&&cookie("client_id",n);var o=getURLParam("sess_id");config.chat_mode=o?"online":"offline",this.initializeMachines(),o?(cookie("sess_id",o,{expires:1,path:"/"}),this.transition("CHECKING_SESSION")):this.transition("OFFLINE")}else this.transition(this._isBlacklisted()||this.isMobileOrTablet()&&config.disable_mobile?"HIDDEN":"LOADING_CSS")}},LOADING_CSS:{_onEnter:function(){if(document.createStyleSheet)document.createStyleSheet(staticUrl("/css/label.css")),ie8&&document.createStyleSheet(staticUrl("/css/label-ie8.css")),devicejs.windowsPhone()&&document.createStyleSheet(staticUrl("/css/label-wp.css")),config.callback_widget&&!this.isMobileOrTablet()&&document.createStyleSheet(staticUrl("/css/call-widget.css"));
else{var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",staticUrl("/css/label.css"));var e=utils.browser;if("Opera"===e.name||"Safari"===e.name&&e.mV<6||"Firefox"===e.name&&e.mV<12){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",staticUrl("/css/label-ie8.css")),document.body.appendChild(i)}if(document.body.appendChild(t),devicejs.windowsPhone()){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",staticUrl("/css/label-wp.css")),document.body.appendChild(n)}if(config.callback_widget&&!this.isMobileOrTablet()){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("href",staticUrl("/css/call-widget.css")),document.body.appendChild(o)}}var s=this.cssDetector=document.createElement("div");s.id="jivo_css_detector",s.style.visibility="hidden",s.style.position="absolute",document.body.appendChild(s),this._scheduleEvent("timer_css",100)},timer_css:function(){if(!(this.cssDetector.offsetWidth>0))return void this._scheduleEvent("timer_css",100);this.initializeMachines();try{if(this._inAir())return window.parentSandboxBridge.process("onIframeDomReady"),void this.transition("HIDDEN")}catch(t){}this.gui.on("transition",underscore.bind(this.handleGuiTransition,this));var e=window.location.hash.split("jvhs_");if(underscore.isUndefined(e[1])||this.gui.highlight(e[1]),window!=window.top){try{if(window.top.jivo_magic_var===jivo_magic_var&&!this.isWixIframe())return this.transition("IN_IFRAME"),void this._callUserFunction("onLoadCallback")}catch(t){}if(!this.isWixIframe())return void this.transition("HIDDEN")}this.isSeparateWindow()||(this._listenVisibility(),this._callUserFunction("onLoadCallback")),cookie("sess_id")?this.transition("CHECKING_SESSION"):this._newSession()},gui_introduced:function(t){this._saveClientInfo(t)}},CHECKING_SESSION:{_onEnter:function(){var t=cookie("sess_id"),e=this.getCurrentPage();getJSONPWithData(chatServerUrl(t,config.site_id,config.widget_id),{name:"url_change",jv_widget_id:config.widget_id,title:setSubstrTitle(e.title),url:e.url},underscore.bind(this.handle,this,"check_session_response")),this._scheduleEvent("timer_check_session",4e3)},check_session_response:function(t){return log("JIVO: Check session response",t),this._cancelEvent("timer_check_session"),"object"==typeof t&&"ok"===t.result?void(t.has_connection?this._pageVisible()?this.transition("RESUMING"):(this.transition(config.chat_mode.toUpperCase()),this.gui.showWidget()):this.transition("RESUMING")):void this._newSession()},timer_check_session:function(){reportException({message:"Check session Timeout"}),this._newSession()}},RESUMING:{_onEnter:function(){connection.resume(cookie("sess_id"))},resume_ok:function(t){this.resumed_context=t;var e,i=this.getCallWidget();i&&(this.resumed_context.client_info.cw_call?(e=this.resumed_context.client_info.cw_call.status,"cw_wait"===e?(log("resume on cw_wait, handle_start_timer"),i.handle("start_timer")):i.handle(e)):i.handle("CLOSED"));var n=t.client_info.msg_history;n&&underscore.findWhere(n,{type:"clientMessage"})&&this.createMagicIFrame();var o=config.chat_mode.toUpperCase();n&&n.length>0&&(o="ONLINE",config.chat_mode="online"),this.transition(o),!this.isMobileOrTablet()||this.isSeparateWindow()?this.isSeparateWindow()||!this.isVisitorsInsight()||!n||0!==n.length||t.agent_info||e?this.gui.handle("resume_ok",t):this.transition("INIT_RULE_MANAGER"):(this.gui.showWidget(),underscore.each(n,function(t){"agentMessage"!==t.type||t.ack||this.gui.incrementCounter()},this),underscore.findWhere(n,{type:"agentMessage",ack:0})||this.gui.resetCounter())},resume_failed:function(){this._newSession()}},HIDDEN:{},IN_IFRAME:{_onEnter:function(){cookie("mframe",null),window.parent.jivo.handle("iframe_url_change",window.location.href,document.title)},highlight_cobrowse:function(t){this.gui.highlight(t)},"*":function(t){underscore.indexOf(["api_open","gui_close_cobrowse"],t)>=0?window.parent.jivo.handle.apply(window.parent.jivo,underscore.toArray(arguments)):log("JIVO: unhandled "+t+" in "+this.state)}},INIT_RULE_MANAGER:{_onEnter:function(){ruleManager.isInited?this.handle("rule_manager_ready"):(ruleManager.on("ready",underscore.bind(this.handle,this,"rule_manager_ready")),ruleManager.init())},rule_manager_ready:function(){"online"===config.chat_mode?(this.isVisitorsInsight()&&connection.handle("startup"),this.transition("ONLINE")):this.transition("OFFLINE"),this.gui.showWidget()},hide:"HIDDEN"},ONLINE:{_onEnter:function(){this.gui.setOnline()},api_open:function(t){this.handle("gui_maximize",t)},invitation:function(t,e){connection.updateClient({chat_opened:!0,page_visible:this._pageVisible(),proactive_rule:{invitation_text:t.invitationText,agent_id:e.agent_id}}),analytics.trackProactiveInvitationShown(t.name),this.ruleName=t.name,this.invitationText=t.invitationText,this.agentInfo=e,this.gui.showInvitation(this.agentInfo,this.invitationText),this.transition("PROACTIVE")},callback_invitation:function(t){var e=this.getCallWidget();e&&e.handle("cw_show_form",{show_form:1,title:t.title}),analytics.trackCallWidgetInvitationShown(t.title)},highlight_cobrowse:function(t){this.gui.highlight(t)},gui_close_cobrowse:function(t){this._stripHashFromLocation(t)},gui_maximize:function(t){this.openParams=t,this.isMobileOrTablet()&&!cookie("sess_id")?this.transition("STARTING_SESSION"):(analytics.trackChatOpenedByClick(),this.gui.showChat(!0,this.openParams))},gui_callwidget:function(){this.gui.showCallWidget()},gui_answer_proactive:function(){cookie("sess_id")&&this.gui.showChat(!0,this.openParams)},gui_typing:function(t){connection.sendIfConnected({name:"client_typing",typing:t})},gui_introduced:function(t,e){this._sendIntroduce(t),e||(analytics.trackGaveContacts(),this._callUserFunction("onIntroduction"))},gui_message:function(t){this.createMagicIFrame();var e={name:"client_message",message:t};this.department_id&&(e.widget_department_id=this.department_id,this.department_id=null),connection.send(e),this.gui.handle("gui_message",t)},gui_department:function(t){this.department_id=t},gui_typing_insight:function(t){connection.sendIfConnected({name:"client_service_message",service:"typing_insight",event:"input_changed",new_val:t})},gui_minimize:function(){jivoTitle.stopBlink(),this.gui.showWidget(!0)},gui_decline_file:function(t,e){jivoTitle.stopBlink(),connection.send({name:"client_service_message",service:"file_transfer",file_id:t,file_name:e,event:"file_declined"})},gui_receive_file:function(t,e){jivoTitle.stopBlink(),connection.send({name:"client_service_message",service:"file_transfer",file_id:t,file_name:e,event:"file_received"})},gui_accept_cobrowse:function(t,e){jivoTitle.stopBlink();var i=document.location.href.split("#")[0],n=t+"#jvhs_"+e,o=document.getElementById("jivo_magic_iframe");if(i===t||i===encodeURI(t)){try{var s=window;o&&(s=o.contentWindow),s.jivo.handle("highlight_cobrowse",e)}catch(a){return void log(a.toString())}this._changeBrowserLocation(n,document.title)}else this.isMobileOrTablet()?window.open(n,document.title):o?site_iframe.navigate(n):document.location.href=n},gui_evaluation:function(t,e){this._sendRate(t,e)},agent_chat_close:function(t){this.invitationText=this.agentInfo=!1,this.gui.handle("agent_chat_close",t)},gui_msg_input_focus:function(){jivoTitle.stopBlink()},"*":function(t,e){this.callWidgetEvents(t,e),underscore.indexOf(["agent_message","agent_service_message","system_message","agent_typing","accept","gui_resume","update_height","transferred","update_agent_info","blacklist","cw_show_form","cw_connected","cw_connecting","cw_call_end"],t)>=0?(this.gui.handle.apply(this.gui,underscore.toArray(arguments)),underscore.indexOf(["agent_message","agent_service_message"],t)>=0&&(jivoTitle.startBlink(),this.isVisitorsInsight()&&e.msg_id&&1===e.msg_id&&!this.invitationText&&1===config.contacts_ask&&(this.invitationText=e.message)),"accept"===t&&this._chatAccepted()):log("JIVO: unhandled "+t+" in "+this.state)},iframe_url_change:function(t,e){this._changeBrowserLocation(t,e),connection.sendIfConnected({name:"url_change",url:t,title:setSubstrTitle(e)})},reopened_elsewhere:function(){jivoTitle.stopBlink(),this.gui.showWidget(!1,!1)},connect_failed:function(){this._forcedOffline="connect_failed",this.transition("OFFLINE"),this.gui.handle("connect_failed")},force_offline:function(t){this._forcedOffline=t.err_code?t.err_code:t.name,this.transition("OFFLINE"),this.gui.handle("connect_failed")},window_visible:function(){!connection.isConnected()&&cookie("sess_id")&&this.transition("CHECKING_SESSION")},gui_start_call:function(){connection.send({name:"request_call",want_call:1})},gui_agent_message_ack:function(t){connection.sendIfConnected({name:"agent_message_ack",ack_msg_ids:t})}},OFFLINE:{_onEnter:function(){jivoTitle.stopBlink(),this.gui.setOffline()},callback_invitation:function(t){var e=this.getCallWidget();e&&e.handle("cw_show_form",{show_form:1,title:t.title}),analytics.trackCallWidgetInvitationShown(t.title)},gui_maximize:function(){analytics.trackOfflineFormOpenedByClick(),this.gui.showChat(!0)},gui_minimize:function(){this.gui.showWidget(!0)},gui_callwidget:function(){this.gui.showCallWidget()},gui_offline_message:function(t){var e=this.getCurrentPage(),i=underscore.pick(t,"email","message","phone","name","cap_id","cap_symbols");underscore.extend(i,{page_url:e.url,page_title:setSubstrTitle(e.title)}),cookie("client_id")&&(i.client_id=cookie("client_id")),cookie("__utmz")&&(i.g_utmz=cookie("__utmz")),cookie("refer")&&(i.refer=cookie("refer"),cookie("utm")&&(i.utm=cookie("utm"))),this._forcedOffline&&(i.from_online=this._forcedOffline),this.isMobile()&&(i.is_mobile=1),"string"==typeof connection.user_token&&(i.user_token=connection.user_token),this._saveClientInfo(i),getJSONPWithData(config.base_url+"/script/offline-form/"+config.widget_id,i,underscore.bind(this.handle,this,"message_response")),this.transition("OFFLINE_WAIT")},gui_leave_msg:function(){this.gui.handle("gui_leave_msg")},api_open:function(){this.handle("gui_maximize")},window_visible:function(){var t=this.getCallWidget();!connection.isConnected()&&cookie("sess_id")?this.transition("CHECKING_SESSION"):cookie("sess_id")||"CALLWIDGET"!==this.gui.state||-1===underscore.indexOf(["CALL","WAIT"],t.state)||t.handle("cw_call_end")},"*":function(t,e){this.callWidgetEvents(t,e),this.updateHeight(t,e)}},OFFLINE_WAIT:{_onEnter:function(){this._scheduleEvent("message_timer",parseInt("5000"))},message_response:function(t){if(this._cancelEvent("message_timer"),"object"==typeof t){if("ok"===t.result)return"client_id"in t&&cookie("client_id",t.client_id,{expires:365,path:"/"}),analytics.trackOfflineMessageSent(),this.gui.handle("offline_success"),void this.transition("OFFLINE");if("error"===t.result&&"cap_id"in t)return this.gui.handle("offline_captcha",t),void this.transition("OFFLINE")}this.gui.handle("offline_failed"),this.transition("OFFLINE")},message_timer:function(){this.gui.handle("offline_failed"),this.transition("OFFLINE")}},PROACTIVE:{gui_minimize:function(){analytics.trackProactiveInvitationRejected(this.ruleName),this.gui.showWidget(!0),this.transition("ONLINE")},gui_message:function(t){this.createMagicIFrame(),analytics.trackProactiveInvitationAccepted(this.ruleName),cookie("agent_info",[this.agentInfo.agent_id].join("$$")),this.isMobileOrTablet()||(connection.send({name:"client_message",message:t}),this.gui.handle("gui_message",t),this.transition("ONLINE"))},gui_answer_proactive:function(){this.transition("STARTING_SESSION")},gui_maximize:function(){this.isMobileOrTablet()&&(analytics.trackProactiveInvitationAccepted(this.ruleName),this.transition("STARTING_SESSION"))},gui_introduced:function(t,e){this._sendIntroduce(t),e||(analytics.trackGaveContacts(),this._callUserFunction("onIntroduction"))},window_visible:function(){!connection.isConnected()&&cookie("sess_id")&&this.transition("CHECKING_SESSION")},api_open:function(t){this.transition("ONLINE"),this.handle("api_open",t)},accept:function(){this.transition("ONLINE"),this._chatAccepted()},cw_ping:function(t,e){this.transition("ONLINE"),connection.sendIfConnected({name:"cw_ping",title:underscore.toArray(arguments)[1]||!1})}},STARTING_SESSION:{_onEnter:function(){connection.handle("startup")},startup_ok:function(){this.transition("ONLINE"),this.gui.showChat(!0,this.openParams)},gui_maximize:function(t){this.gui.showChat(!0,t)}}}});"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,o,s,a,r=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;s>i;i+=1)a[i]=str(i,c)||"null";return o=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]",gap=r,o}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;s>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],o=str(n,c),o&&a.push(quote(n)+(gap?": ":":")+o));else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(o=str(n,c),o&&a.push(quote(n)+(gap?": ":":")+o));return o=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}",gap=r,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,n,o=t[e];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n=walk(o,i),void 0!==n?o[i]=n:delete o[i]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(t){var e=t.setTimeout,i=t.document,n=0;t.jivoXHR=function(){function o(){try{u.parentNode.removeChild(u)}catch(t){}}function s(){h=!1,l="",o(),u=null}function a(t){try{d.onerror.call(d,t,l)}catch(e){throw new Error(t)}}function r(){this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||h||(this.onload=this.onreadystatechange=null,h=!0,4!==d.readyState&&a("Script failed to load ["+l+"]."),o())}function c(t){t=t||[],d.readyState=4,d.status=200,"function"==typeof d.onload&&d.onload.apply(d,t)}var l,h,u,d=null;return d={onerror:null,onload:null,readyState:0,open:function(e,i){s();var o="cb"+n++;!function(e){t.jivoXHR[e]=function(){try{c.call(d,arguments)}catch(i){d.readyState=-1,a(i.message)}t.jivoXHR[e]=null}}(o),l=i.replace(/=\?/,"=jivoXHR."+o)},send:function(){e(function(){u=i.createElement("script"),u.setAttribute("type","text/javascript"),u.charset="UTF-8",u.onload=u.onreadystatechange=function(){r.call(u)},u.setAttribute("src",l),i.getElementsByTagName("head")[0].appendChild(u)},0)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}},s(),d}}(window),function(){"use strict";if("undefined"!=typeof module&&module.exports&&"undefined"!=typeof require)var t=require("log4js").getLogger("pushengine"),e=require("underscore"),i=require("machina")(e),n=require("xmlhttprequest").XMLHttpRequest,o=require("./time_machine"),s=require("ws"),a=!0;else{var e=underscore,i=machina,o=TimeMachine,n=XMLHttpRequest;if("undefined"!=typeof WebSocket)var s=WebSocket;var t={};e.each(["debug","warn","error","info"],function(e){t[e]=function(){var t=Array.prototype.slice.call(arguments);"string"==typeof t[0]?t[0]="CONNECTION: "+t[0]:t.unshift("CONNECTION: "),log.apply(log,t)}});var a=!1}var r=i.Fsm.extend({namespace:"CONNECTION",host:"node.jivosite.com",resource:"cometan",srv_rotate:!1,allow_fallback:!0,server_index:0,plain_port:80,secure_port:443,secure:!0,mode:"ws",open:function(){this.handle("cmd_open")},close:function(){this.handle("cmd_close")},push:function(t){this.handle("cmd_push",t)},initialState:"CLOSED",initialize:function(){this.socket=!1},wsUri:function(){var e=[],i=this.host;return this.secure?(e.push("wss:/"),this.secure_port&&(i+=":"+this.secure_port)):(e.push("ws:/"),this.plain_port&&(i+=":"+this.plain_port)),e.push(i,this.resource),t.debug("wsUri="+e.join("/")),e.join("/")},jivoOptions:function(){return e.pick(this,"secure","host","resource","plain_port","secure_port","srv_rotate")},setSocket:function(t){if(this.socket){var i=this.socket;i.onopen=i.onclose=i.onerror=i.onmessage=function(){},i=null}this.socket=t,t.onopen=e.bind(this.handle,this,"socket_open"),t.onclose=e.bind(this.handle,this,"socket_close"),t.onerror=e.bind(this.handle,this,"socket_error"),t.onmessage=e.bind(this.handle,this,"socket_message")},states:{CLOSED:{cmd_open:"OPENING",cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){t.debug("Already closed")},socket_close:function(e){t.info("Socket close",e.code,e.reason),this.emit("disconnect",e.code,e.reason)}},OPENING:{_onEnter:function(){if("ws"==this.mode){if(s){var e="plain";a&&(e={protocol:"plain"});try{this.setSocket(new s(this.wsUri(),e))}catch(i){t.error("Could not create websocket",i.message),this.allow_fallback?(t.debug("Falling back to polling"),this.mode="jivo",this.setSocket(new c(this.jivoOptions()))):(t.debug("Fallback to polling disabled"),this.transition("CLOSED"),this.emit("connect_failed",i.message))}return}t.debug("WebSocket is not supported")}this.mode="jivo",this.setSocket(new c(this.jivoOptions()))},socket_open:function(){this.transition("OPENED")},socket_error:function(e){if(t.error("Socket error!",e.message),"function"==typeof reportException&&reportException({message:e.message||"Socket error"}),"ws"==this.mode){if(this.allow_fallback)return t.debug("Falling back to polling"),this.mode="jivo",void this.setSocket(new c(this.jivoOptions()));t.info("Fallback to polling is disabled")}this.transition("CLOSED"),this.emit("connect_failed",e.message)},socket_close:function(){this.handle("socket_error",{message:"Socket closed while opening"})},connect_failed:function(t){this.transition("CLOSED"),this.emit("connect_failed",t)},cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){this.transition("CLOSED"),this.socket.close()}},OPENED:{_onEnter:function(){this.emit("connect",this.mode)},cmd_push:function(t){this.socket.send(JSON.stringify(t))},socket_message:function(t){"object"==typeof t.data?this.emit("message",t.data):this.emit("message",JSON.parse(t.data))},socket_close:function(e){t.info("Socket close",e.code,e.reason),this.emit("disconnect",e.code,e.reason),this.transition("CLOSED")},cmd_close:function(){this.socket.close(),this.transition("CLOSED")}}}}),c=i.Fsm.extend({namespace:"SOCKET",initialize:function(){if(a)this.mode="xhr";else{var t=new n;this.mode="withCredentials"in t?"xhr":"jsonp",t=null}this.pull_channel=new l({master:this}),this.push_channel=new h({master:this})},xhrObject:function(){return"xhr"==this.mode?new n:new jivoXHR},cometUrl:function(t,e){var i;"object"!=typeof e&&(e={}),e.t=(new Date).getTime();var n=this.host;if("push"==t[0]){var o=n.split(".");o.length>1&&(o[0]+="psh",n=o.join("."))}if(this.srv_rotate&&this.server_index>0){var o=n.split(".");o[0]+="-"+this.server_index,n=o.join(".")}i=this.secure?["https:/",n+":"+this.secure_port,this.resource].join("/"):["http:/",n+":"+this.plain_port,this.resource].join("/"),i+="/"+t.join("/")+"?","jsonp"==this.mode&&(i+="cb=?&");var s=[];for(var a in e)s.push(a+"="+encodeURIComponent(e[a]));return i+s.join("&")},close:function(t,e){this.handle("cmd_close",t,e)},send:function(t){this.handle("cmd_push",t)},states:{uninitialized:{_onEnter:function(){this.pull_channel.handle("open"),this.transition("CONNECTING")}},CONNECTING:{connect:function(){t.debug("Pull channel connected",this.socket_id),this.transition("OPEN")},connect_failed:function(t){"function"==typeof this.onerror&&this.onerror.call(this,t),this.transition("CLOSED")},cmd_push:function(){throw new Error("Push before connect")}},OPEN:{_onEnter:function(){this.push_channel.handle("open"),"function"==typeof this.onopen&&this.onopen.call(this)},cmd_push:function(t){this.push_channel.handle("push",t)},message:function(t){"function"==typeof this.onmessage&&this.onmessage.call(this,{data:t})},disconnect:function(t,e){this.transition("CLOSED"),"function"==typeof this.onclose&&this.onclose.call(this,{code:t,reason:e})},cmd_close:function(){this.transition("CLOSED")}},CLOSED:{_onEnter:function(){this.push_channel.handle("close")},disconnect:function(t,e){"function"==typeof this.onclose&&this.onclose.call(this,{code:t,reason:e})}}}}),l=o.extend({initialState:"CLOSED",namespace:"SOCKET-PULL",initialize:function(){},_pull:function(){this.pull_request=this.master.xhrObject(),this.pull_request.open("GET",this.master.cometUrl(["pull",this.master.socket_id])),this.pull_request.onload=e.bind(this.handle,this,"pull_load"),this.pull_request.onerror=e.bind(this.handle,this,"pull_error"),this.pull_request.send(),this._scheduleEvent("pull_timeout",this.hold_timeout),this.reconnect_state="PULL",this.transition("PULL")},_ack:function(){this.pull_request=this.master.xhrObject(),this.pull_request.open("GET",this.master.cometUrl(["ack",this.master.socket_id],{mid:this.last_message_id})),this.pull_request.onload=e.bind(this.handle,this,"pull_load"),this.pull_request.onerror=e.bind(this.handle,this,"pull_error"),this.pull_request.send(),this._scheduleEvent("pull_timeout",this.hold_timeout),this.reconnect_state="ACK",this.transition("PULL")},_startReconnect:function(){this.reconnect_counter>5?(this.master.handle("disconnect",1006,"Reconnect failed"),this.transition("CLOSED")):(this._scheduleEvent("reconnect",1e3),this.transition("RECONNECT_WAIT"))},_fin:function(){this.fin_request=this.master.xhrObject(),this.fin_request.open("GET",this.master.cometUrl(["fin",this.master.socket_id])),this.fin_request.onload=e.bind(this.handle,this,"fin_load"),this.fin_request.onerror=e.bind(this.handle,this,"fin_error"),this.fin_request.send(),this.transition("FIN")},states:{CLOSED:{open:"SYN"},SYN:{_onEnter:function(){this.syn_request=this.master.xhrObject(),this.syn_request.open("GET",this.master.cometUrl(["syn"])),this.syn_request.onload=e.bind(this.handle,this,"syn_load"),this.syn_request.onerror=e.bind(this.handle,this,"syn_error"),this.syn_request.send(),this._scheduleEvent("syn_timeout",5e3)},syn_load:function(e){if(this._cancelEvent("syn_timeout"),"xhr"==this.master.mode)try{e=JSON.parse(this.syn_request.responseText)}catch(i){return this.transition("CLOSED"),void this.master.handle("connect_failed",i)}"c"==e.t?(this.master.socket_id=e.sid,this.hold_timeout=e.ht+2e3,this.master.handle("connect"),this._pull()):t.error("Unexpected syn response",e)},syn_error:function(e){t.error(e),this._cancelEvent("syn_timeout"),this.transition("CLOSED"),this.master.handle("connect_failed",e)},syn_timeout:function(){this.syn_request.onload=this.syn_request.onerror=function(){},this.syn_request.abort(),this.transition("CLOSED"),this.master.handle("connect_failed",new Error("Connection timed out"))}},PULL:{pull_load:function(e){if(this._cancelEvent("pull_timeout"),"xhr"==this.master.mode)try{e=JSON.parse(this.pull_request.responseText)}catch(i){return t.error("Error parsing pull response",this.pull_request.responseText,i.message),this.master.handle("disconnect",1006,"Connection reset"),void this.transition("CLOSED")}this.reconnect_counter=0,"k"==e.t?(this.hold_timeout=e.ht+2e3,this._pull()):"m"==e.t?(this.last_message_id=e.mid,this._ack(),this.master.handle("message",e.msg)):"r"==e.t?(this.master.handle("disconnect",1006,"Connection reset"),this.transition("CLOSED")):"d"==e.t&&(this.master.handle("disconnect",1e3,e.r),this.transition("CLOSED"))},pull_error:function(e){t.warn("Pull error",e),this._cancelEvent("pull_timeout"),this._startReconnect("PULL")},pull_timeout:function(){t.warn("Pull timeout"),this.pull_request.onload=this.pull_request.onerror=function(){},this.pull_request.abort(),this._startReconnect("PULL")},close:function(){this._cancelEvent("pull_timeout"),this.pull_request.onload=this.pull_request.onerror=function(){},this.pull_request.abort(),this._fin()}},RECONNECT_WAIT:{_onEnter:function(){this.hold_timeout=5e3},reconnect:function(){this.reconnect_counter+=1,"ACK"==this.reconnect_state?this._ack():this._pull()}},FIN:{_onEnter:function(){this._scheduleEvent("fin_timeout",2e3)},fin_timeout:function(){t.warn("FIN timeout"),this.transition("CLOSED")},fin_load:function(){this._cancelEvent("fin_timeout"),this.transition("CLOSED")},fin_error:function(e){t.error(e),this._cancelEvent("fin_timeout"),this.transition("CLOSED")}}}}),h=o.extend({initialState:"CLOSED",namespace:"SOCKET-PUSH",initialize:function(){this.queue=[]},_push:function(){this.push_request=this.master.xhrObject(),"jsonp"==this.master.mode?this.push_request.open("GET",this.master.cometUrl(["push",this.master.socket_id],{msg:this.queue[0]}),!0):(this.push_request.open("POST",this.master.cometUrl(["push",this.master.socket_id]),!0),this.push_request.setRequestHeader("Content-type","text/plain;charset=UTF-8")),this.push_request.onload=e.bind(this.handle,this,"push_load"),this.push_request.onerror=e.bind(this.handle,this,"push_error"),this.push_request.send(this.queue[0]),this.transition("PUSHING")},states:{CLOSED:{open:function(){this.transition("READY")},close:function(){}},READY:{push:function(t){this.queue.unshift(t),this._push()},close:function(){this.transition("CLOSED")}},PUSHING:{_onEnter:function(){this._scheduleEvent("push_timeout",3e3)},push:function(e){var i=this.queue.push(e);t.debug("Message put to queue",i)},push_load:function(){this._cancelEvent("push_timeout"),this.queue.shift(),this.queue.length>0?this._push():this.transition("READY")},push_error:function(e){t.error(this.master.socket_id+": push error",e)},close:function(){this._cancelEvent("push_timeout"),this.push_request.onload=this.push_request.onerror=function(){},this.push_request.abort(),this.transition("CLOSED")},push_timeout:function(){this.push_request.onload=this.push_request.onerror=function(){},this.push_request.abort(),this.transition("RETRY")}},RETRY:{_onEnter:function(){this._scheduleEvent("retry_push",2e3)},retry_push:function(){this._push()},push:function(e){var i=this.queue.push(e);t.debug(this.master.socket_id+": message put to queue",i)},close:function(){this._cancelEvent("push_timeout"),this.transition("CLOSED")}}}});a?module.exports=r:this.JivoConnection=r}.call(this);var connection=new TimeMachine({namespace:"CONMANAGER",msg_buf:[],sess_id:!1,send:function(t){log("SEND: ",t),this.handle("send",t)},sendIfConnected:function(t){this.isConnected()&&(log("SEND IF CONNECTION: ",t),this.handle("send",t))},resume:function(t){this.handle("resume",t)},initialize:function(){var t=!1;t=!0,this.jivoConnection=new JivoConnection(underscore.extend(underscore.clone(config.comet),{resource:"cometcn",mode:cookie("cm")||"ws",secure:t}));for(var e=["connect","message","disconnect","connection_reset","connect_failed"],i=0;i<e.length;i++)this.jivoConnection.on(e[i],underscore.bind(this.handle,this,"socket_"+e[i]))},_sendSocketEvent:function(t){"object"==typeof t?"name"in t?(log("Sending "+t.name),this.jivoConnection.push(t)):this.warn("Attempt to send event without name"):this.warn("Socket event must be object")},_bufferMessage:function(t){this.msg_buf.push(t)},_flushMessageBuffer:function(){for(var t;t=this.msg_buf.shift();)this.jivoConnection.push(t)},isConnected:function(){return"CONNECTED"===this.state},setCustomData:function(t){this.isConnected()?this.send({name:"update_custom_data",custom_data:t}):this.custom_data=t},setUserToken:function(t){this.isConnected()?this.send({name:"update_user_token",user_token:t}):this.user_token=t},createClientModel:function(){this.clientModel||(this.clientModel={chat_opened:"CHAT"===cookie("gui_state"),page_visible:jivo._pageVisible()})},updateClient:function(t){var e={name:"update_client"};this.createClientModel();var i=underscore.clone(this.clientModel);underscore.extend(this.clientModel,t),underscore.isEqual(this.clientModel,i)||(underscore.extend(e,t),this.sendIfConnected(e))},states:{uninitialized:{send:function(t){this._bufferMessage(t),this.sess_id=cookie("sess_id"),this.transition("CONNECTING")},resume:function(t){this.sess_id=t,this.transition("CONNECTING")},startup:function(){this.sess_id=!1,this.transition("CONNECTING")}},CONNECTING:{_onEnter:function(){this.jivoConnection.open()},socket_connect:function(t){cookie("cm",t),this.transition(this.sess_id?"RESUMING":"STARTING_UP")},send:function(t){this._bufferMessage(t)},socket_connect_failed:function(){jivo.handle("connect_failed"),this.transition("uninitialized")}},STARTING_UP:{_onEnter:function(){this.createClientModel();var t={name:"startup",jv_widget_id:config.widget_id,site_id:config.site_id,current_page:jivo.getCurrentPage(),is_mobile:jivo.isMobile(),visits_count:cookie("visits_count")-0};t=underscore.extend(t,this.clientModel),cookie("client_id")&&(t.jv_client_id=cookie("client_id"),log("CONNECTION: restored client #"+t.jv_client_id)),cookie("__utmz")&&(t.g_utmz=cookie("__utmz")),cookie("agent_info")&&(t.pa_id=cookie("agent_info").split("$$")[0],log("CONNECTION: restored agent #"+t.pa_id)),cookie("client_name")&&(t.client_name=cookie("client_name"),log("CONNECTION: restored client name="+t.client_name)),cookie("email")&&(t.email=cookie("email"),log("CONNECTION: restored client email="+t.email)),cookie("phone")&&(t.phone=cookie("phone"),log("CONNECTION: restored client phone="+t.phone)),cookie("refer")&&(t.refer=cookie("refer"),cookie("utm")&&(t.utm=cookie("utm"))),jivo.invitationText&&(t.proactive_rule={invitation_text:jivo.invitationText,agent_info:jivo.agentInfo}),this.custom_data&&(t.custom_data=this.custom_data),this.user_token&&(t.user_token=this.user_token),this._sendSocketEvent(t),this._scheduleEvent("startup_timeout",3e3)},startup_timeout:function(){reportException({message:"Startup Timeout"})},send:function(t){this._bufferMessage(t)},socket_message:function(t){"startup_ok"===t.name?(this._cancelEvent("startup_timeout"),cookie("sess_id",t.jv_sess_id,{expires:1,path:"/"}),cookie("client_id",t.jv_client_id,{expires:365,path:"/"}),this.transition("CONNECTED")):"startup_error"===t.name&&(jivo.handle("force_offline",t),this.transition("DISCONNECTING"))}},RESUMING:{_onEnter:function(){this.createClientModel(),this._sendSocketEvent(underscore.extend({name:"resume",jv_sess_id:this.sess_id,jv_widget_id:config.widget_id,
site_id:config.site_id,visits_count:cookie("visits_count")-0,separate_window:jivo.isSeparateWindow(),current_page:jivo.getCurrentPage()},this.clientModel))},socket_message:function(t){"resume_ok"==t.name?(jivo.handle(t.name,t),this.transition("CONNECTED")):(jivo.handle("resume_failed"),this.transition("DISCONNECTING"))}},CONNECTED:{_onEnter:function(){jivo.handle("startup_ok"),this._flushMessageBuffer()},socket_message:function(t){underscore.indexOf(["agent_chat_close","force_offline","blacklist"],t.name)>=0&&(jivo.isVisitorsInsight()||this.transition("DISCONNECTING"),"blacklist"===t.name&&cookie("client_id","z"+cookie("client_id"))),underscore.indexOf(["cw_call_end","cw_error"],t.name)>=0&&"OFFLINE"===jivo.state&&this.transition("DISCONNECTING"),underscore.indexOf(["accept","transferred"],t.name)>=0&&cookie("agent_info",[t.agent_info.agent_id].join("$$")),jivo.handle(t.name,t)},send:function(t){this.jivoConnection.push(t)},socket_disconnect:function(t){1e3==t&&jivo.handle("reopened_elsewhere"),this.transition("uninitialized")},startup:function(){jivo.handle("startup_ok")}},DISCONNECTING:{_onEnter:function(){cookie("sess_id",null),this.sess_id=!1,this.jivoConnection.close()},socket_disconnect:function(){this.transition("uninitialized")}}}}),JivoPhantom=TimeMachine.extend({namespace:"PHANTOM",element:!1,type:"chat",PHANTOM_ID:"jivo_phantom",TIMEOUT_TRANSITION:300,TIMEOUT_TRANSITION_DEBOUNCE:1,initialize:function(){function t(){this._transitionEndTimeout&&clearTimeout(this._transitionEndTimeout),this.handle("animate_finished")}var e=this.element=document.createElement("div");e.id=this.PHANTOM_ID,prefixedEvent(e,"TransitionEnd",this.handleTransitionEnd),this.topWrap.appendChild(e),addClass(e,"jivo-"+config.widget_orientation),e.style.background=config.widget_color,this.handleTransitionEnd=underscore.debounce(underscore.bind(t,this),this.TIMEOUT_TRANSITION_DEBOUNCE)},setRect:function(t){return setElementPosition(this.element,t),this},setTransition:function(t){return toggleClass(this.element,"jivo-notransition",!t),this},animate:function(t,e){var i=this.element,n="EXPANDING"===this.state;toggleClass(i,"jivo-phantom-chat",n),toggleClass(i,"jivo-phantom-label",!n),this.setTransition(!1).setRect(t,!0).setTransition(!0),setTimeout(underscore.bind(function(){this.setRect(e),this._transitionEndTimeout=setTimeout(this.handleTransitionEnd,this.TIMEOUT_TRANSITION)},this),0)},initialState:"HIDDEN",states:{ANIMATED:{_onEnter:function(){this.emit("animated"),this._scheduleEvent("hide",this.TIMEOUT_TRANSITION)},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){this.setTransition(!1)},collapse:function(t,e){this.transition("COLLAPSING"),this.animate(e,t)},expand:function(t,e){this.transition("EXPANDING"),this.animate(t,e)}},EXPANDING:{animate_finished:"ANIMATED"},COLLAPSING:{animate_finished:"ANIMATED"}}}),analytics={_yaCounter:!1,_trackedEvents:[],_trackEvent:function(t,e){underscore.indexOf(this._trackedEvents,t)>=0||(this._trackedEvents.push(t),log("ANALYTICS _trackEvent: "+t+"/"+e),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","JivoSite",t,e,void 0,!0]),"function"==typeof ga&&ga("send","event","JivoSite",t,e,{nonInteraction:1}),this._yaCounter&&(t=["Jivo"].concat(t.split(" ")).join("_"),window[this._yaCounter].reachGoal(t)))},_setCustomVar:function(t,e){if(log("ANALYTICS _setCustomVar: "+t+"/"+e),"undefined"!=typeof _gaq&&_gaq.push(["_setCustomVar",1,t,e,1]),"function"==typeof ga&&ga("set",t,e),this._yaCounter){var i={};i[t]=e,window[this._yaCounter].params(i)}},findYaCounter:function(){try{for(var t in window)0==t.indexOf("yaCounter")&&"function"==typeof window[t].reachGoal&&(this._yaCounter=t)}catch(e){log("ANALYTICS: "+e.toString())}},trackChatOpenedByClick:function(){this._trackEvent("Chat requested","User clicked chat widget")},trackOfflineFormOpenedByClick:function(){this._trackEvent("Offline form shown","User offline form")},trackOfflineMessageSent:function(){this._trackEvent("Offline message sent","User sent message via offline form")},trackProactiveInvitationShown:function(t){this._trackEvent("Proactive invitation shown",t)},trackProactiveInvitationAccepted:function(t){this._trackEvent("Proactive invitation accepted",t)},trackProactiveInvitationRejected:function(t){this._trackEvent("Proactive invitation rejected",t)},trackChatConnected:function(){this._trackEvent("Chat established","User connected to agent")},trackGaveContacts:function(){this._trackEvent("User gave contacts during chat","User gave contacts during chat")},trackCallWidgetInvitationShown:function(t){this._trackEvent("Callback invitation shown",t)},trackCallWidgetRequested:function(t){this._trackEvent("Callback requested",t)},setABTestGroupContacts:function(t,e){this._setCustomVar(t,e)}};analytics.findYaCounter();var jivo_api=window.jivo_api={open:function(t){var e=jivo.getCallWidget();"object"==typeof t&&"call"===t.start&&e?callWidgetPing(underscore.bind(function(i){i.show_form&&"WIDGET"===jivo.gui.state?jivo.handle("cw_show_form",{show_form:1}):jivo.handle("api_open",t),e.analyticsTitle="apiCall"},this),{title:!1,invitation:"jivo_api.open"}):jivo.handle("api_open",t)},getContactInfo:function(){if(underscore.find(utils.fields,function(t){return cookie(t)})){var t={};return underscore.each(utils.fields,function(e){cookie(e)&&(t["client_name"===e?"name":e]=cookie(e))}),t}},getVisitorNumber:function(t){var e=cookie("client_id");return e&&e.indexOf(".")>0&&"function"==typeof t?void setTimeout(function(){t(null,e.split(".").shift())},0):void getJSONPWithData(config.base_url+"/script/get-visitor-number/"+config.widget_id,{site:config.site_id},function(e){if("object"==typeof e&&e.result&&"client_id"in e){if(cookie("client_id",e.client_id,{expires:365,path:"/"}),"function"==typeof t)return void t(null,e.client_id.split(".").shift());t(new Error("Error fetching visitor number"))}})},setUserToken:function(t){("string"==typeof t||t instanceof String)&&connection.setUserToken(t)},setCustomData:function(t){"[object Array]"===Object.prototype.toString.call(t)&&connection.setCustomData(t)},setContactInfo:function(t){if(t&&"object"==typeof t)for(var e in t){var i=t[e],n={},o=!1;underscore.find(utils.fields,function(t){return"client_name"===t?"name"===e:t===e})&&!cookie("name"===e?"client_name":e)&&utils["isValidValue_"+e](i)&&(n[e]=i,o=!0),o&&jivo.handle("gui_introduced",n,!0)}},showProactiveInvitation:function(t,e){ruleManager.showProactive(t,e,"jivo_api.showProactiveInvitation")},setRules:function(t){t&&"object"==typeof t&&(config.rules=t)},chatMode:function(){return config.chat_mode}},site_iframe={frm:0,create:function(){if(config.disable_iframe)return void log("Magic iframe is disabled");if(this.frm)return void log("Magic iframe already created");if(cookie("mframe"))return void log("Magic iframe create cancelled, page may be protected from iframe");cookie("mframe",1),log("Creating iframe");var t=document.createElement("iframe");t.setAttribute("id","jivo_magic_iframe"),t.setAttribute("class","jivo-frame-hidden"),t.setAttribute("frameborder","0px"),t.setAttribute("name","col_old_page"),document.body.appendChild(t),t.contentWindow.location=window.location,this.frm=t,setIframeLoadCallback(t,underscore.bind(this.onFrameLoaded,this))},onFrameLoaded:function(){log("Magic frame content loaded. Time to show the frame...");document.getElementById("jivo_top_wrap");document.body.setAttribute("id","jivo_outer_body"),document.body.style.overflow="hidden",document.body.scroll="no";for(var t=document.getElementsByTagName("iframe"),e=0;e<t.length;e++){var i=t[e];"jivo_magic_iframe"!=i.id&&"jivo_chat_iframe"!=i.id&&(i.style.display="none")}if(this.frm.setAttribute("class","jivo-frame-visible"),this.frm.style.display="block",this.hasScroll().vScrollbar){var n=this.getScrollBarWidth()+"px";log("Adjusting right margin. Scroll width="+n),document.getElementById("jivo-chat").style.marginRight=n,document.getElementById("jivo-label").style.marginRight=n}this.syncPageScroll()},navigate:function(t){log("navigating iframe to ",t),this.frm.contentDocument.location.href=t},getDoc:function(){var t=this.frm.contentWindow.document;return t||(t=this.frm.contentDocument),t?t:(log("Cannot find document!! :("),0)},syncPageScroll:function(){var t=0,e=0;"number"==typeof window.pageYOffset?(e=window.pageYOffset,t=window.pageXOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(e=document.body.scrollTop,t=document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(e=document.documentElement.scrollTop,t=document.documentElement.scrollLeft),log("scroll pos x="+t+" y="+e),this.frm.contentWindow.scrollTo(t,e)},getScrollBarWidth:function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",t.appendChild(i);var n=i.offsetWidth;return t.parentNode.removeChild(t),e-n},hasScroll:function(){var t={vScrollbar:!0,hScrollbar:!0};try{var e="BackCompat"==document.compatMode?document.body:document.documentElement;t.vScrollbar=e.scrollHeight>e.clientHeight,t.hScrollbar=e.scrollWidth>e.clientWidth}catch(i){}return t}};!function(t,e){t.VMasker=e()}(this,function(){var t="9",e="A",i="S",n=[8,9,16,17,18,36,37,38,39,40,91,92,93],o=function(t){for(var e=0,i=n.length;i>e;e++)if(t==n[e])return!1;return!0},s=function(t){return t=t||{},t={precision:t.hasOwnProperty("precision")?t.precision:2,separator:t.separator||",",delimiter:t.delimiter||".",unit:t.unit&&t.unit.replace(/[\s]/g,"")+" "||"",suffixUnit:t.suffixUnit&&" "+t.suffixUnit.replace(/[\s]/g,"")||"",zeroCents:t.zeroCents,lastOutput:t.lastOutput},t.moneyPrecision=t.zeroCents?0:t.precision,t},a=function(n,o,s){for(;o<n.length;o++)(n[o]===t||n[o]===e||n[o]===i)&&(n[o]=s);return n},r=function(t){this.elements=t};r.prototype.unbindElementToMask=function(){for(var t=0,e=this.elements.length;e>t;t++)this.elements[t].lastOutput="",this.elements[t].onkeyup=!1,this.elements[t].onkeydown=!1,this.elements[t].value.length&&(this.elements[t].value=this.elements[t].value.replace(/\D/g,""))},r.prototype.bindElementToMask=function(t){for(var e=this,i=function(i){i=i||window.event;var n=i.target||i.srcElement;o(i.keyCode)&&setTimeout(function(){e.opts.lastOutput=n.lastOutput,n.value=c[t](n.value,e.opts),n.lastOutput=n.value,n.setSelectionRange&&e.opts.suffixUnit&&n.setSelectionRange(n.value.length,n.value.length-e.opts.suffixUnit.length)},0),jivo.cw.callwidget.checkTel(i)},n=0,s=this.elements.length;s>n;n++)this.elements[n].lastOutput="",this.elements[n].onkeyup=i,this.elements[n].value.length&&(this.elements[n].value=c[t](this.elements[n].value,this.opts))},r.prototype.maskMoney=function(t){this.opts=s(t),this.bindElementToMask("toMoney")},r.prototype.maskNumber=function(){this.opts={},this.bindElementToMask("toNumber")},r.prototype.maskAlphaNum=function(){this.opts={},this.bindElementToMask("toAlphaNumeric")},r.prototype.maskPattern=function(t){this.opts={pattern:t},this.bindElementToMask("toPattern")},r.prototype.unMask=function(){this.unbindElementToMask()};var c=function(t){if(!t)throw new Error("VanillaMasker: There is no element to bind.");var e="length"in t?t.length?t:[]:[t];return new r(e)};return c.toMoney=function(t,e){if(e=s(e),e.zeroCents){e.lastOutput=e.lastOutput||"";var i="("+e.separator+"[0]{0,"+e.precision+"})",n=new RegExp(i,"g"),o=t.toString().replace(/[\D]/g,"").length||0,a=e.lastOutput.toString().replace(/[\D]/g,"").length||0;t=t.toString().replace(n,""),a>o&&(t=t.slice(0,t.length-1))}var r=t.toString().replace(/[\D]/g,""),c=new RegExp("^(0|\\"+e.delimiter+")"),l=new RegExp("(\\"+e.separator+")$"),h=r.substr(0,r.length-e.moneyPrecision),u=h.substr(0,h.length%3),d=new Array(e.precision+1).join("0");h=h.substr(h.length%3,h.length);for(var f=0,m=h.length;m>f;f++)f%3===0&&(u+=e.delimiter),u+=h[f];if(u=u.replace(c,""),u=u.length?u:"0",!e.zeroCents){var g=r.length-e.precision,v=r.substr(g,e.precision),_=v.length,p=e.precision>_?e.precision:_;d=(d+v).slice(-p)}var w=e.unit+u+e.separator+d+e.suffixUnit;return w.replace(l,"")},c.toPattern=function(n,o){var s,r="object"==typeof o?o.pattern:o,c=r.replace(/\W/g,""),l=r.split(""),h=n.toString().replace(/\W/g,""),u=h.replace(/\W/g,""),d=0,f=l.length,m="object"==typeof o?o.placeholder:void 0;for(s=0;f>s;s++){if(d>=h.length){if(c.length==u.length)return l.join("");if(void 0!==m&&c.length>u.length)return a(l,s,m).join("");break}if(l[s]===t&&h[d].match(/[0-9]/)||l[s]===e&&h[d].match(/[a-zA-Z]/)||l[s]===i&&h[d].match(/[0-9a-zA-Z]/))l[s]=h[d++];else if(l[s]===t||l[s]===e||l[s]===i)return void 0!==m?a(l,s,m).join(""):l.slice(0,s).join("")}return l.join("").substr(0,s)},c.toNumber=function(t){return t.toString().replace(/(?!^-)[^0-9]/g,"")},c.toAlphaNumeric=function(t){return t.toString().replace(/[^a-z0-9 ]+/i,"")},c});var coBrowserIframeCreater=window.coBrowserIframeCreater=function(){function t(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&(t.attachEvent("on"+e,function(t){return function(){i.call(t,window.event)}}(t)),t=null)}var e,i,n=!1,o=[],s=!1,a={},r=function(t,c){log("coBrowserIframeCreater has received event "+t);var l=document.getElementById("jivo_frame");if(l||(l=jivoFrame.init(function(){log("jivoFrame has been inited"),e&&e.postMessage({name:"widget_ready"},i),n=!0,r()})),!n)return void o.push({name:t,params:c});if(o.length){var h=o.shift();t=h.name,c=h.params}var u;if(s){log("controller of childSandboxBridge set as for NodeWebkit"),u=l.contentWindow.jqueryFrameControllerForAir,u.setLangpack(a);var d=document.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("href",staticUrl("/css/for_air.css")),document.body.appendChild(d),u.init()}else u=l.contentWindow.jqueryFrameController;u[t]&&"is_node_webkit"!=t?u[t](c):log("controller has not "+t),o.length&&r()},c=!1;return t(window,"message",function(t){var n=t.data;"in_node_webkit"==n.name&&(e||(e=t.source,i=t.origin),s=!0,a=n.langpack,c=!0),c&&i==t.origin&&r(n.name,n)},!1),{process:function(t,e){r(t,e)},postMessage:function(t){e&&e.postMessage(t,i)},isNodeWebkit:function(){return s}}}(),jqueryFrame=window.childSandboxBridge={_queue:[],_ready:0,_inAir:0,process:function(t,e){var i=document.getElementById("jivo_frame");if(i||(window.parentSandboxBridge&&window.parentSandboxBridge.inAir&&(this._inAir=!0),i=jivoFrame.init(function(){log("jivoFrame has been inited"),window.parentSandboxBridge&&window.parentSandboxBridge.process("onJqueryIframeReady"),childSandboxBridge._ready=!0,childSandboxBridge.process()})),!this._ready)return void this._queue.push({name:t,params:e});if(this._queue.length){var n=this._queue.shift();t=n.name,e=n.params}var o;if(this.inAir()){log("controller of childSandboxBridge set as for Air"),o=i.contentWindow.jqueryFrameControllerForAir;var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href",staticUrl("/css/for_air.css")),document.body.appendChild(s),o.init()}else o=i.contentWindow.jqueryFrameController;log("childSandboxBridge has received event "+t),o[t]?o[t](e):log("controller has not "+t),this._queue.length&&this.process()},inAir:function(){return this._inAir}};if(window.parentSandboxBridge){var log=function(t){window.parentSandboxBridge.log(t)};log("parentSandboxBridge.initInterface() called"),window.parentSandboxBridge.initInterface()}var jivoFrame={_content:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>		<html>		<head>			<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />			<script type='text/javascript'  src='"+staticUrl("/js/jquery_frame.js")+"'></script>			<script type='text/javascript'>    lblDefaultCobrowseComment='"+translate("lblDefaultCobrowseComment")+"';			</script>		</head>		<body >		</body>        </html>",_iframe:0,init:function(t){return this._iframe=document.createElement("iframe"),this._iframe.setAttribute("id","jivo_frame"),this._iframe.setAttribute("frameBorder","0"),this._iframe.setAttribute("scrolling","no"),this._iframe.allowTransparency=!0,this._iframe.style.backgroundColor="transparent",this._iframe.style.display="none",window.document.body.appendChild(this._iframe),setIframeLoadCallback(this._iframe,t),this._doc=this._getDoc(),this._doc.open(),this._doc.write(this._content),this._doc.close(),this._window=this._iframe.contentWindow,this._iframe.contentWindow.controller=this,this._iframe},_getDoc:function(){return this._iframe.contentDocument?this._iframe.contentDocument:this._iframe.contentWindow?this._iframe.contentWindow.document:(log("WARNING! chat_iframe._doc is null"),0)}},_call_templates={callWidgetForm:underscore.template(["<div class='jivo-call-form jivo-call-form-low' style='display:none;'>","<div class='jivo-form-box'>","<div class='jivo-form-inner'>","<a href='#' title='"+translate("cw_close")+"' class='jivo-close-form'></a>","<div class='jivo-form-header'>","<div class='jivo-form-low-phone'></div>","<div class='jivo-call-text'>","<span class='jivo-text-center'>"+translate("cw_weRecallAfter")+" <span class='jivo-text-time'>28</span> <span class='jivo-text-sec'>"+translate("cw_seconds")+"</span>!</span>","</div>","</div>","<div class='jivo-error-header'>","<div class='jivo-title-ce'>"+translate("cw_unableToConnect")+"</div>","<div class='jivo-call-repeat'>","<div class='jivo-err-info'>"+translate("cw_errInfoText")+"</div>","</div>","</div>","<div id='jivo-call-form'>","<div class='jivo-call-form-shadow'>","<div class='jivo-tel-box'>","<div class='jivo-tel-placeholder'>"+translate("cw_enterPhonePlaceholder")+"</div>","<span class='jivo-tel-pre-code'>+7</span><!--input id='jivo-call-code' type='tel' name='jivo-code' maxlength='3' placeholder='___'/><span class='jivo-tel-after-code'>)</span-->","<input id='jivo-call-tel' type='tel' value='' name='jivo-tel' maxlength='12' placeholder='926 123 4567'/>","</div>","</div>","<a id='jivo-save-tel' title='"+translate("cw_callButtonText")+"'><i class='jivo-call-icon'></i>"+translate("cw_callButtonText")+"</a>","</div>","<div class='jivo-call-copy'>","<a href='#' class='jivo-start-chat'><i class='jivo-ico-start-chat'></i>{{ sendMessage }}</a>","</div>","<a href='http://jivosite.ru/?utm_source=megashop.ru&utm_medium=link&utm_content=callback_popup&utm_campaign=self_ad' target='_blank' title='Jivosite' class='jivo-logo'><span class='j1'>jivo</span><span class='j2'>site</span></a>","</div>","<div id='jivo-call-container'></div>","</div>","</div>"].join("\n")),callWidgetActions:underscore.template(["<div class='jivo-call-action jivo-hidden' style='display: none;'>","<div class='jivo-call-step jivo-call-wait'>","<div class='jivo-text-ca'>"+translate("cw_callAfter")+"</div>","<div id='jivo-timer-block' class='jivo-timer-block'>","<div class='jivo-call-loader' data-anim='base wrapper'>","<div class='jivo-call-circle' data-anim='base left'></div>","<div class='jivo-call-circle' data-anim='base right'></div>","</div>","<div class='jivo-action-timer'>","<span id='jivo-time' class='jivo-time'>28</span>","</div>","</div>"+translate("cw_seconds")+"</div>","<div class='jivo-call-step jivo-call-connecting'>","<div class='jivo-call-box-wrap'>","<div class='jivo-circle jivo-anim-circle'></div><div class='jivo-circle jivo-anim-circle2'></div>","<div class='jivo-call-box'>","<i class='jivo-connecting-icon'><i class='jivo-anim-wait'></i></i>","</div>","</div>","<div class='jivo-text-conn'>"+translate("cw_connecting")+"</div>","</div>","<div class='jivo-call-step jivo-call-connected'>","<div class='jivo-call-box'>","<div class='jivo-call-up'>","<i class='jivo-calling-icon'></i>translate('cw_weCalling')<br>","<span class='jivo-calling-up-phone'>"+translate("cw_pickUpPhone")+"</span>","</div>","<div class='jivo-call-online'>","<div class='jivo-operator-icon'>","<img id='jivo-operator-icon' src='"+config.base_url+"/images/jivo-ico-operator.png' alt=''/>","<i class='jivo-operator-icon-mobile'></i>","</div>","<div class='jivo-operator-name'>","Константин<br>","Манженко","<small>Менеджер-консультант</small>","</div>","<div class='jivo-connected-show-chat'>"+translate("cw_chat")+"</div>","</div>","<div class='jivo-call-end'>","<a href='#' class='jivo-close-form'></a>","<div class='jivo-end-box'>","<div class='jivo-thx-text'>"+translate("cw_thxForCall")+"</div>","<a href='#' class='jivo-btn-recall'>"+translate("cw_repeatCallAgain")+"</a>","<a href='#' class='jivo-start-chat'><i class='jivo-ico-start-chat'></i>{{ sendMessage }}</a>","</div>","</div>","</div>","</div>","<a href='http://jivosite.ru/?utm_source=megashop.ru&utm_medium=link&utm_content=callback_popup&utm_campaign=self_ad' target='_blank' title='Jivosite' class='jivo-logo'><span class='j1'>jivo</span><span class='j2'>site</span></a>","</div>","<div class='jivo-call-error jivo-call-step' style='display: none;'>","<div class='jivo-end-close'></div>","<div class='jivo-title-ce'>"+translate("cw_unableToConnect")+"</div>","<div class='jivo-call-repeat'>","<div class='jivo-err-info'>"+translate("cw_errInfoText")+"</div>","</div>","<div id='jivo-call-form'>","<div class='jivo-call-form-shadow'>","<div class='jivo-tel-box'>","<div class='jivo-tel-placeholder'>"+translate("cw_enterPhonePlaceholder")+"</div>","<span class='jivo-tel-pre-code'>+7</span><!--input id='jivo-call-code' type='tel' name='jivo-code' maxlength='3' placeholder='___'/><span class='jivo-tel-after-code'>)</span-->","<input id='jivo-call-tel' type='tel' name='jivo-tel' maxlength='12' placeholder='926 123 4567'/>","</div>","</div>","<a id='jivo-save-tel' title='"+translate("cw_callButtonText")+"'><i class='jivo-call-icon'></i>"+translate("cw_callButtonText")+"</a>","</div>","<div class='jivo-call-copy'>","<a href='#' class='jivo-start-chat'><i class='jivo-ico-start-chat'></i>{{ sendMessage }}</a>","</div>","<a href='http://jivosite.ru/?utm_source=megashop.ru&utm_medium=link&utm_content=callback_popup&utm_campaign=self_ad' target='_blank' title='Jivosite' class='jivo-logo'><span class='j1'>jivo</span><span class='j2'>site</span></a>","<div class='jivo-report-form'>","<p>"+translate("cw_reportPlaceholder")+"</p>","<!--div class='jivo-text-right'>","<a href='#' class='jivo-btn jivo-btn-report'>"+translate("cw_textSend")+"</a>","</div-->","</div>","</div>"].join("\n"))},CallWidget=TimeMachine.extend({initialState:"CLOSED",namespace:"CALLWIDGET",formType:2,templateForm:_call_templates.callWidgetForm,templateCall:_call_templates.callWidgetActions,containerForm:"jivo-form-container",containerCall:"jivo-call-container",form:null,call:null,phone:0,timer:0,clickClosedForm:!0,initTel:function(){var t,e=(this.phone=document.getElementById("jivo-call-tel"),cookie("phone"));e&&(e=e.substring(2,12),t=document.getElementById("jivo-call-tel"),t.value=e,removeClass(t,"jivo-disabled")),this.actionForElements(".jivo-start-chat",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.transition("FORMHIDDEN"),this.guiMaximize()},this)}),this.initMask()},checkTel:function(t){var e=this.phone=document.getElementById("jivo-call-tel"),i=t.keyCode||t.whitch;12===e.value.toString().length&&removeClass(e,"jivo-disabled"),13===i&&document.getElementById("jivo-save-tel").click()},initMask:function(){VMasker(this.phone).maskPattern("999 999 9999")},guiMaximize:function(){jivo.isClicked=!0,jivo.handle("gui_maximize")},actionForElements:function(t,e){"."===t.charAt(0)?underscore.each(getElementsByClassName(t.substr(1)),e,this):underscore.each([document.getElementById(t.substr(1))],e,this)},showElement:function(t){if(!underscore.isArray(t)){var e=[];e.push(t),t=e}underscore.each(t,function(t){this.actionForElements(t,function(t){t.style.display="block"})},this)},hideElement:function(t){if(!underscore.isArray(t)){var e=[];e.push(t),t=e}underscore.each(t,function(t){this.actionForElements(t,function(t){t.style.display="none"})},this)},addClass:function(t,e){this.actionForElements(t,function(t){addClass(t,e)})},removeClass:function(t,e){this.actionForElements(t,function(t){removeClass(t,e)})},showAction:function(){this.showElement(".jivo-call-action")},drawTimer:function(t){var e=3.6*t,i=".jivo-call-loader",n="jivo-call-circle";t>50?(this.addClass(i,"gt50"),underscore.each(getElementsByClassName(n),function(t,e){1===e&&addClass(t,"fill")},this)):(this.removeClass(i,"gt50"),underscore.each(getElementsByClassName(n),function(t,e){1===e&&removeClass(t,"fill")},this)),this.actionForElements("."+n,function(t){t.style.webkitTransform="rotate("+e+"deg)",t.style.MozTransform="rotate("+e+"deg)",t.style.msTransform="rotate("+e+"deg)",t.style.OTransform="rotate("+e+"deg)",t.style.transform="rotate("+e+"deg)"})},center:function(t){t.css({position:"fixed",top:"50%",left:"50%",margin:"-141px 0 0 -"+t.width()/2+"px"})},secOfNum:function(t){var e=[translate("cw_form_second"),translate("cw_form_seconds"),translate("cw_form_secondd")],i=[2,0,1,1,1,2];return e[t%100>4&&20>t%100?2:i[5>t%10?t%10:5]]},initialize:function(){if(document.getElementById(this.containerCall))log("JivoCall already initialized.");else{var t=translate("online"===config.chat_mode?"cw_typeInChat":"lblLeaveMessage"),e={sendMessage:t};this.form=document.createElement("div"),this.form.setAttribute("id",this.containerForm),this.form.innerHTML=this.templateForm(e),jivo.gui._wrapDiv.appendChild(this.form),this.call=document.getElementById(this.containerCall),this.call.innerHTML=this.templateCall(e),this.showElement(["#"+this.containerForm,"#"+this.containerCall]),this.actionForElements(".jivo-call-form",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),t.stopPropagation(),this.transition("FORMHIDDEN")},this)}),this.actionForElements(".jivo-form-box",function(t){t.onclick=underscore.bind(function(t){t.stopPropagation()},this)})}window.onresize=underscore.throttle(underscore.bind(function(){this.actionForElements(".jivo-call-form",function(t){t.style.left=jivo.gui.getChatTop().getPosition().left+"px",t.style.right="auto"})},this),100),underscore.each(["cw_wait","cw_connecting","cw_calling","cw_connected","cw_error","cw_call_end","cw_show_form"],underscore.bind(function(t){jivo.on(t,underscore.bind(function(e){this.handle(t,e)},this))},this)),jivo.on("startup_ok",underscore.bind(function(t){this.resumed_context.client_info.cw_call&&this.handle(this.resumed_context.client_info.cw_call.status,t)},this)),this.initTel(),this.actionForElements(".jivo-close-form",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.clickClosedForm=!0,jivo.gui.widget.handle("show"),this.transition("FORMHIDDEN")},this)}),css3AnimationIsSupported()&&jivo.gui.phantom.on("transition",underscore.bind(this.handlePhantomTranstion,this)),this.actionForElements("#jivo-save-tel",function(t){t.onclick=underscore.bind(this.clickTel,this)}),this.actionForElements(".jivo-call-close",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.transition("FORMHIDDEN")},this)}),this.actionForElements(".jivo-btn-recall",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.hideElement(".jivo-call-error"),this.transition("FORMVISIBLE")},this)}),this.actionForElements(".jivo-btn-start-chat",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.hideElement(".jivo-call-end"),this.transition("FORMHIDDEN"),this.guiMaximize()},this)}),this.actionForElements(".jivo-end-close",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.clickClosedForm=!0,this.hideElement(".jivo-call-end"),this.removeClass(".jivo-call-error","jivo-error-visible"),setTimeout(underscore.bind(function(){this.hideElement(".jivo-call-error")},this),200),this.transition("FORMHIDDEN")},this)}),this.actionForElements(".jivo-btn-report",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),this.hideElement(".jivo-call-error"),this.showLabel(),jivo.handle("gui_maximize")},this)}),this.actionForElements(".jivo-connected-show-chat",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),jivo.gui.enableAnimation(!1),this.guiMaximize()},this)}),this.actionForElements(".jivo-show-chat",function(t){t.onclick=underscore.bind(function(t){t.preventDefault(),jivo.gui.enableAnimation(!1),this.guiMaximize()},this)}),this.trackLogo(),utils.showAd()||this.addClass(".jivo-logo","jivo-hide")},trackLogo:function(){var t="http://www.jivosite.ru/";"ru_RU"!=jivo_config.locale&&(t="https://www.jivochat.com/"),this.actionForElements(".jivo-logo",function(e){e.setAttribute("href",t+"?utm_source="+window.location.host+"&utm_medium=link&utm_content=callback_popup&utm_campaign=self_ad")})},clickTel:function(t){t.preventDefault();var e=document.getElementById("jivo-call-tel").value.replace(/\D/g,"");10===e.toString().length?(removeClass(this.phone,"jivo-disabled"),this.phone_number="+7"+e.toString(),this.setTimerNull(),this.transition("FORMANIMATE")):(addClass(this.phone,"jivo-disabled"),this.phone.focus())},setTimerNull:function(){clearInterval(this.timer),cookie("cw_timer",null),this.removeClass(".jivo-timer-block","jivo-timer-show")},hideCallWidget:function(){var t=".jivo-call-form";this.hideElement(t),this.actionForElements(t,function(t){t.style.bottom="-350px",t.style.top="auto"}),this.showElement(t)},showCallWidget:function(){var t=".jivo-call-form";this.hideElement(t),this.actionForElements(t,function(t){t.style.bottom="-4px",t.style.top="auto"}),this.showElement(t)},handlePhantomTranstion:function(t){"CLOSED"!==this.state&&"FORMVISIBLE"!==this.state&&("COLLAPSING.animate_finished"===t.action&&(this.showCallWidget(),setTimeout(function(){jivo.gui.widget.handle("hide")},50)),"EXPANDING.animate_finished"===t.action&&this.hideCallWidget())},showLabel:function(){jivo.gui.showLabelForCallWidget(),jivo.handle("gui_minimize")},hideLabel:function(){jivo.handle("gui_callwidget")},states:{CLOSED:{_onEnter:function(){this.hideElement(".jivo-call-action"),this.hideCallWidget(),log(jivo.state,jivo.gui.widget.state,jivo.gui.state),"CALLWIDGET"===jivo.gui.state&&this.showLabel()},cw_show_form:function(t){return this.showform=t,"cw_wait"===this.currentState?void this.handle("cw_wait",t):void(1===this.showform.show_form&&this.transition("FORMVISIBLE"))},start_timer:"WAIT",cw_connecting:function(){this.currentState="cw_connecting",this.transition("CALL")},cw_connected:function(){this.currentState="cw_connected",this.transition("CALL")},cw_wait:function(){cookie("cw_timer",null),this.transition("WAIT")},setPhoneNumber:function(t){this.phone.value=t.replace(/^8|^\+7|^7/,""),this.initMask(),this.analyticsTitle="phoneEnter",document.getElementById("jivo-save-tel").click()}},FORMVISIBLE:{_onEnter:function(){this.hideLabel(),clearInterval(this.timer),this.currentState="",this.clickClosedForm=!1,this.hideElement([".jivo-call-action",".jivo-call-error"]),this.actionForElements(".jivo-text-time",function(t){t.innerHTML=this.seconds}),this.actionForElements(".jivo-text-sec",function(t){t.innerHTML=this.secOfNum(this.seconds)}),this.hideElement(".jivo-error-header"),this.showElement([".jivo-form-inner",".jivo-form-header",".jivo-form-low-phone",".jivo-logo"]),1===this.formType&&this.center(this.form.find(".jivo-form-box")),this.actionForElements(".jivo-call-form",function(t){t.style.left=jivo.gui.getChatTop().getPosition().left+"px",t.style.right="auto",t.style.height="350px"}),this.showform&&(this.showform.title&&"string"==typeof this.showform.title?(telemetry("show_call_widget_invitation"),this.actionForElements(".jivo-text-center",function(t){t.innerHTML=this.showform.title,this.analyticsTitle=this.showform.title})):telemetry("show_call_widget"),this.hideCallWidget(),setTimeout(underscore.bind(function(){this.showCallWidget()},this),50)),this.actionForElements(".jivo-call-form",function(t){t.style.display="block"}),this.actionForElements(".jivo-form-box",function(t){t.style.opacity="1"}),this.showElement(".jivo-form-box")},cw_show_form:function(t){t.show_form&&(this.hideLabel(),this.showCallWidget())},cw_wait:function(){
this.transition("WAIT")},start_timer:"WAIT"},FORMHIDDEN:{_onEnter:function(){this.actionForElements(".jivo-call-form",function(t){t.style.bottom="-350px"}),setTimeout(underscore.bind(function(){this.transition("CLOSED"),this.showLabel()},this),200)}},FORMANIMATE:{_onEnter:function(){this.showElement(".jivo-call-action"),this.actionForElements(".jivo-call-action",function(t){t.style.opacity="1"}),this.handle("animatefinished")},animatefinished:function(){cookie("phone",this.phone_number),this.transition("WAIT"),this.showform&&this.showform.title&&"string"==typeof this.showform.title?jivo.handle("cw_call",{tel:this.phone_number,invitation_text:this.showform.title}):jivo.handle("cw_call",{tel:this.phone_number})},cw_error:function(){this.transition("cw_error")},cw_call_end:function(){this.transition("cw_call_end")}},WAIT:{"*":function(t){this.emit.apply(this,underscore.toArray(arguments))},_onEnter:function(){this.hideLabel(),this.showElement(".jivo-logo"),clearInterval(this.timer),this.analyticsTitle&&analytics.trackCallWidgetRequested(this.analyticsTitle),this.handle("cw_wait")},cw_wait:function(){hasClass(document.getElementById("jivo-timer-block"),"jivo-timer-show")||(this.removeClass(".jivo-timer-block","jivo-timer-show"),this.hideElement([".jivo-form-inner",".jivo-call-action",".jivo-call-error"]),this.showElement(".jivo-call-form"),this.actionForElements(".jivo-call-form",function(t){t.style.bottom="-4px",t.style.top="auto"}),this.hideElement(".jivo-form-header"),this.showElement("#"+this.containerCall),this.actionForElements(".jivo-call-wait",function(t){t.style.opacity="0"}),this.hideElement([".jivo-call-step",".jivo-call-loader"]),this.showElement([".jivo-call-action",".jivo-call-wait",".jivo-call-loader",".jivo-form-low-phone"]),this.addClass(".jivo-timer-block","jivo-timer-show"),this.seconds&&this.handle("start_timer",this.seconds))},_onExit:function(){},start_timer:function(t){this.actionForElements("#"+this.containerForm,function(t){t.style.opacity="1"}),t=this.seconds,this.showElement(".jivo-call-wait");var e=1e3*t,i=document.getElementById("jivo-time");i.innerHTML=e/1e3,clearInterval(this.timer),this.timer=setInterval(underscore.bind(function(){if(cookie("cw_timer")){var t=parseInt((new Date).getTime())-parseInt(cookie("cw_timer"));if(e=1e3*this.initTimer-t,e=1e3*(e/1e3).toFixed(1),0>=e)return clearInterval(this.timer),this.timer=!1,void this.handle("timer_finished")}else cookie("cw_timer",(new Date).getTime());this.actionForElements(".jivo-call-wait",function(t){t.style.opacity="1"}),i.innerHTML=e/1e3%1===0&&Number(e)===e?e/1e3+".0":e/1e3;var n=100-e/1e3/this.initTimer*100;this.drawTimer(n),e-=100,0>=e&&(i.innerHTML=e,clearInterval(this.timer),this.timer=!1,this.handle("timer_finished"))},this),100)},timer_finished:function(){this.handle("cw_connecting")},cw_connecting:function(t){this.agent_info=t,this.transition("CALL")},cw_connected:function(){this.currentState="cw_connected",this.transition("CALL")},cw_error:function(t){t&&t.reason&&(this.error_reason=t.reason),this.transition("cw_error")},cw_call_end:function(){this.transition("cw_call_end")}},CALL:{_onEnter:function(){this.showElement("#"+this.containerCall),this.hideElement(".jivo-form-inner"),this.showElement(".jivo-call-form"),this.actionForElements(".jivo-call-form",function(t){t.style.bottom="-4px"}),this.showElement(".jivo-logo"),"CHAT"===jivo.gui.state?this.hideCallWidget():this.hideLabel(),this.currentState?(this.handle(this.currentState),this.currentState=!1):this.handle("cw_connecting")},cw_wait:function(t){this.handle("cw_connecting",t)},timer_finished:function(){this.timer=!1,this.handle("cw_connecting")},cw_connecting:function(t){!this.agent_info&&t&&(this.agent_info=t),this.removeClass(".jivo-call-error","jivo-error-visible"),this.hideElement(".jivo-form-header"),this.showAction(),jivo.resumed_context&&jivo.resumed_context.agent_info&&(this.agent_info=jivo.resumed_context.agent_info),this.timer||(this.hideElement([".jivo-call-step",".jivo-call-end"]),this.actionForElements(".jivo-call-connected",function(t){t.setAttribute("style","")}),this.removeClass(".jivo-call-box","jivo-operator-online"),this.hideElement(".jivo-call-online"),this.showElement([".jivo-form-low-phone",".jivo-call-connecting"]))},cw_connected:function(){clearInterval(this.timer),this.hideElement(".jivo-logo"),jivo.resumed_context&&jivo.resumed_context.agent_info&&(this.agent_info=jivo.resumed_context.agent_info,this.actionForElements(".jivo-call-form",function(t){t.style.height="72px"})),this.agent_info&&(null!=this.agent_info.avatar_url?document.getElementById("jivo-operator-icon").setAttribute("src",jivo_config.avatar_url+"/avatars/"+this.agent_info.avatar_url):document.getElementById("jivo-operator-icon").setAttribute("src",jivo_config.base_url+"/images/jivo-ico-operator.png"),this.agent_info.display_name&&this.actionForElements(".jivo-operator-name",function(t){t.innerHTML=this.agent_info.display_name+" <small>"+this.agent_info.title+"</small>"})),this.hideElement([".jivo-form-header",".jivo-error-header",".jivo-form-low-phone",".jivo-call-step",".jivo-call-up",".jivo-call-end"]),this.showAction(),this.showElement([".jivo-call-connected",".jivo-call-online"]),this.actionForElements(".jivo-call-form",function(t){t.style.height="72px"}),this.handle("operator_online")},operator_online:function(){clearInterval(this.timer),this.showElement(".jivo-call-online"),this.agent_info&&(0===this.agent_info.state?this.hideElement(".jivo-connected-show-chat"):this.showElement(".jivo-connected-show-chat"))},cw_error:function(){this.transition("cw_error")},cw_call_end:function(){this.transition("cw_call_end")},CLOSED:function(){this.transition("CLOSED")},cw_show_form:"cw_connected"},cw_call_end:{_onEnter:function(){jivo.resumed_context=!1,"CHAT"!==jivo.gui.state&&this.hideLabel(),this.setTimerNull(),this.showElement(".jivo-logo"),this.hideElement([".jivo-form-header",".jivo-error-header",".jivo-form-low-phone",".jivo-call-step",".jivo-call-up"]),this.showElement(".jivo-call-connected"),this.removeClass(".jivo-thx-text","jivo-thx-text-show"),this.removeClass(".jivo-call-box","jivo-operator-online"),this.addClass(".jivo-call-box","jivo-operator-call-end"),this.hideElement([".jivo-call-online",".jivo-call-online"]),this.showElement(".jivo-call-end"),this.actionForElements(".jivo-call-form",function(t){t.style.height="350px",this.addClass(".jivo-thx-text","jivo-thx-text-show")})},start_timer:function(){this.currentState="cw_wait",this.transition("WAIT")},cw_show_form:function(){this.transition("FORMVISIBLE")},cw_wait:function(){this.transition("wait")},CLOSED:"CLOSED",_onExit:function(){this.removeClass(".jivo-thx-text","jivo-thx-text-show")}},cw_error:{_onEnter:function(){this.hideLabel(),jivo.resumed_context=!1,this.setTimerNull(),this.hideElement("#"+this.containerCall),this.hideElement(".jivo-form-header"),this.showElement([".jivo-logo",".jivo-error-header",".jivo-form-inner"]),this.actionForElements("#jivo-call-tel",function(t){t.value=this.phone.value}),this.hideElement([".jivo-call-step",".jivo-call-action"]),this.error_reason?(this.actionForElements(".jivo-title-ce",function(t){t.innerHTML=""}),this.actionForElements(".jivo-err-info",function(t){t.innerHTML=translate(this.error_reason)}),delete this.error_reason):(this.actionForElements(".jivo-title-ce",function(t){t.innerHTML=translate("cw_unableToConnect")}),this.actionForElements(".jivo-err-info",function(t){t.innerHTML=translate("cw_errInfoText")})),setTimeout(underscore.bind(function(){this.addClass(".jivo-call-error","jivo-error-visible")},this),5)},cw_show_form:"FORMVISIBLE"}}}),soundPlayer={_divId:"jivo_sound_player",_playOnReady:!1,initialize:function(t){jivo.isMobileOrTablet()&&jivo.isSeparateWindow()?this.audio=document.getElementById(this._divId):(ie8||ie9?(this.audio=document.createElement("embed"),this.audio.setAttribute("src",staticUrl("/sounds/incoming_message.wav")),this.audio.setAttribute("autostart",!1),this.audio.setAttribute("loop",!1),this.audio.setAttribute("width",0),this.audio.setAttribute("height",0)):this.audio=document.createElement("audio"),this.audio.setAttribute("id",this._divId),t.appendChild(this.audio))},incomingMessage:function(){this._playOnReady||jivo.isSeparateWindow()||ie8||ie9||(this.audio.innerHTML=_templates.sound_player({mp3:staticUrl("/sounds/incoming_message.mp3",!0),ogg:staticUrl("/sounds/incoming_message.ogg",!0),wav:staticUrl("/sounds/incoming_message.wav",!0)}),this._playOnReady=!0),this.play()},pause:function(){"undefined"!=typeof this.audio.pause&&this.audio.pause()},play:function(){"undefined"!=typeof this.audio.play&&this.audio.play()}}})();var widgetContainer,widgetLoaded;jivo.isMobile()?widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap"),widgetContainer&&!jivo.ignore_viewport&&(widgetContainer.className+="mobile-version",document.getElementById("jivo-label").style.right="auto",jivoMobileLabel(),clearInterval(widgetLoaded))},100):jivo.isTablet()&&(widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap"),widgetContainer&&(widgetContainer.className+="tablet-version",clearInterval(widgetLoaded))},100));